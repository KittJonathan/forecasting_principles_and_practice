<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Forecasting Principles and Practice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="fpp3_files/libs/clipboard/clipboard.min.js"></script>
<script src="fpp3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="fpp3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="fpp3_files/libs/quarto-html/popper.min.js"></script>
<script src="fpp3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="fpp3_files/libs/quarto-html/anchor.min.js"></script>
<link href="fpp3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="fpp3_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="fpp3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="fpp3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="fpp3_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Forecasting Principles and Practice</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chapter-1---getting-started" class="level1">
<h1>Chapter 1 - Getting started</h1>
<p><a href="https://otexts.com/fpp3/intro.html" class="uri">https://otexts.com/fpp3/intro.html</a></p>
<section id="what-can-be-forecast" class="level2">
<h2 class="anchored" data-anchor-id="what-can-be-forecast">1.1 What can be forecast?</h2>
<p><a href="https://otexts.com/fpp3/what-can-be-forecast.html" class="uri">https://otexts.com/fpp3/what-can-be-forecast.html</a></p>
<p>Which is easiest to forecast (from easiest at the top to hardest at the bottom):</p>
<ol type="1">
<li>time of sunrise this day next year</li>
<li>timing of next Halley’s comet appearance</li>
<li>maximum temperature tomorrow</li>
<li>daily electricity demand in 3 days time</li>
<li>total sales of drugs in Australian pharmacies next month</li>
<li>Google stock price tomorrow</li>
<li>exchange rate of $US/AUS next week</li>
<li>Google stock price in 6 months time</li>
</ol>
<p>Something is easier to forecast if:</p>
<ol type="1">
<li>we have a good understanding of the factors that contribute to it</li>
<li>there is lots of data available</li>
<li>the future is somewhat similar to the past</li>
<li>the forecasts cannot affect the thing we are trying to forecast</li>
</ol>
</section>
<section id="forecasting-goals-and-planning" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-goals-and-planning">1.2 Forecasting, goals and planning</h2>
<p><a href="https://otexts.com/fpp3/planning.html" class="uri">https://otexts.com/fpp3/planning.html</a></p>
<p><strong>Forecasting</strong> is about predicting the future as accurately as possible, given all of the information available, including historical data and knowledge of any future events that might impact the forecasts.</p>
<p><strong>Goals</strong> are what you would like to happen. Goals should be linked to forecasts and plans, but this does not always occur. Too often, goals are set without any plan for how to achieve them, and no forecasts for whether they are realistic.</p>
<p><strong>Planning</strong> is a response to forecasts and goals. Planning involves determining the appropriate actions that are required to make your forecasts match your goals.</p>
<p><strong>Short-term forecasts</strong> are needed for the scheduling of personnel, production and transportation. As part of the scheduling process, forecasts of demand are often also required.</p>
<p><strong>Medium-term forecasts</strong> are needed to determine future resource requirements, in order to purchase raw materials, hire personnel, or buy machinery and equipment.</p>
<p><strong>Long-term forecasts</strong> are used in strategic planning. Such decisions must take account of market opportunities, environmental factors and internal resources.</p>
</section>
<section id="determining-what-to-forecast" class="level2">
<h2 class="anchored" data-anchor-id="determining-what-to-forecast">1.3 Determining what to forecast</h2>
<p><a href="https://otexts.com/fpp3/determining-what-to-forecast.html" class="uri">https://otexts.com/fpp3/determining-what-to-forecast.html</a></p>
<ul>
<li><p>What should be forecast?</p></li>
<li><p>Consider the forecasting horizon</p></li>
<li><p>How frequently are forecasts required?</p></li>
</ul>
</section>
<section id="forecasting-data-and-methods" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-data-and-methods">1.4 Forecasting data and methods</h2>
<p><a href="https://otexts.com/fpp3/data-methods.html" class="uri">https://otexts.com/fpp3/data-methods.html</a></p>
<p>If there are no data available, or if the available data are not relevant to the forecasts, then <strong>qualitative forecasting</strong> must be used.</p>
<p><strong>Quantitative forecasting</strong> can be applied when two conditions are satisfied:</p>
<ol type="1">
<li>numerical information about the past is available</li>
<li>it is reasonable to assume that some aspects of the past patterns will continue into the future</li>
</ol>
<p>We wish to forecast the hourly electricity demand (ED) of a hot region during the summer period. A model with predictor variables might be of the form</p>
<p><span class="math display">\[
ED=f(current\ temp,strength\ of\ economy, population, time\ of\ day, day\ of\ week, error)
\]</span></p>
<p>The “error” term allows for random variation and the effects of relevant variables that are not included in the model.</p>
<p>We could use a <strong>time series model</strong>, of the form</p>
<p><span class="math display">\[
ED_{t+1}=f(ED_t,ED_{t-1},ED_{t-2},ED_{t-3},...,error)
\]</span></p>
<p>A third type of model combines the features of the above two models:</p>
<p><span class="math display">\[
ED_{t+1}=f(ED_t,current\ temp,time\ of\ day,day\ of\ week,error)
\]</span></p>
</section>
<section id="some-case-studies" class="level2">
<h2 class="anchored" data-anchor-id="some-case-studies">1.5 Some case studies</h2>
<p><a href="https://otexts.com/fpp3/case-studies.html" class="uri">https://otexts.com/fpp3/case-studies.html</a></p>
</section>
<section id="the-basic-steps-in-a-forecasting-task" class="level2">
<h2 class="anchored" data-anchor-id="the-basic-steps-in-a-forecasting-task">1.6 The basic steps in a forecasting task</h2>
<p><a href="https://otexts.com/fpp3/basic-steps.html" class="uri">https://otexts.com/fpp3/basic-steps.html</a></p>
<p>Step 1: Problem definition</p>
<p>Step 2: Gathering information</p>
<p>Step 3: Preliminary (exploratory) analysis</p>
<p>Step 4: Choosing and fitting models</p>
<p>Step 5: Using and evaluating a forecasting model</p>
</section>
<section id="the-statistical-forecasting-perspective" class="level2">
<h2 class="anchored" data-anchor-id="the-statistical-forecasting-perspective">1.7 The statistical forecasting perspective</h2>
<p>A forecast is an estimate of the probabilities of possible futures.</p>
<p>Statistical forecasting:</p>
<ul>
<li><p>Thing to be forecast: a random variable, <span class="math inline">\(y_t\)</span></p></li>
<li><p>Forecast distribution: if <span class="math inline">\(I\)</span> is all observations, then <span class="math inline">\(y_{t|I}\)</span> means “the random variable <span class="math inline">\(y_t\)</span> given what we know in <span class="math inline">\(I\)</span></p></li>
<li><p>The “point forecast” is the mean (or median) of <span class="math inline">\(y_t|I\)</span></p></li>
<li><p>The “forecast variance” is <span class="math inline">\(var[y_t|I]\)</span></p></li>
<li><p>A prediction interval or “interval forecast” is a range of values of <span class="math inline">\(y_t\)</span> with high probability</p></li>
<li><p>With time series, <span class="math inline">\(y_{t|t-1}=y_t|\{y_1,y_2,...,y_{t-1}\}\)</span></p></li>
<li><p><span class="math inline">\(\hat{y}_{T+h|T}=E[y_{T+h}|y_1,...,y_T]\)</span> (an h-step forecast taking account of all observations up to time <span class="math inline">\(T\)</span>).</p></li>
</ul>
</section>
</section>
<section id="chapter-2---time-series-graphics" class="level1">
<h1>Chapter 2 - Time series graphics</h1>
<section id="tsibble-objects" class="level2">
<h2 class="anchored" data-anchor-id="tsibble-objects">2.1 <code>tsibble</code> objects</h2>
<p><a href="https://otexts.com/fpp3/tsibbles.html" class="uri">https://otexts.com/fpp3/tsibbles.html</a></p>
<p>Load the <code>fpp3</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'tsibble':
  method               from 
  as_tibble.grouped_df dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── fpp3 1.0.1.9000 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ tibble      3.2.1     ✔ tsibble     1.1.6
✔ dplyr       1.1.4     ✔ tsibbledata 0.4.1
✔ tidyr       1.3.1     ✔ feasts      0.4.1
✔ lubridate   1.9.4     ✔ fable       0.4.1
✔ ggplot2     3.5.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────────────── fpp3_conflicts ──
✖ lubridate::date()    masks base::date()
✖ dplyr::filter()      masks stats::filter()
✖ tsibble::intersect() masks base::intersect()
✖ tsibble::interval()  masks lubridate::interval()
✖ dplyr::lag()         masks stats::lag()
✖ tsibble::setdiff()   masks base::setdiff()
✖ tsibble::union()     masks base::union()</code></pre>
</div>
</div>
<p>Example of a <code>tsibble</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>global_economy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 15,150 x 9 [1Y]
# Key:       Country [263]
   Country     Code   Year         GDP Growth   CPI Imports Exports Population
   &lt;fct&gt;       &lt;fct&gt; &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 Afghanistan AFG    1960  537777811.     NA    NA    7.02    4.13    8996351
 2 Afghanistan AFG    1961  548888896.     NA    NA    8.10    4.45    9166764
 3 Afghanistan AFG    1962  546666678.     NA    NA    9.35    4.88    9345868
 4 Afghanistan AFG    1963  751111191.     NA    NA   16.9     9.17    9533954
 5 Afghanistan AFG    1964  800000044.     NA    NA   18.1     8.89    9731361
 6 Afghanistan AFG    1965 1006666638.     NA    NA   21.4    11.3     9938414
 7 Afghanistan AFG    1966 1399999967.     NA    NA   18.6     8.57   10152331
 8 Afghanistan AFG    1967 1673333418.     NA    NA   14.2     6.77   10372630
 9 Afghanistan AFG    1968 1373333367.     NA    NA   15.2     8.90   10604346
10 Afghanistan AFG    1969 1408888922.     NA    NA   15.0    10.1    10854428
# ℹ 15,140 more rows</code></pre>
</div>
</div>
<ul>
<li><p>15,150 rows and 9 columns</p></li>
<li><p>The data are 1 year apart: <code>[1Y]</code></p></li>
<li><p>There is a key variable, <code>country</code>, and 263 countries in the dataset</p>
<ul>
<li><p>there are 263 separate time series</p></li>
<li><p>the key variable determines the different time series</p></li>
</ul></li>
<li><p>An index variable is the variable that indexes the time series (e.g.&nbsp;<code>year</code>)</p></li>
<li><p>All the other variables are <em>measured variables</em></p></li>
</ul>
<p>Another example of <code>tsibble</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tourism</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 24,320 x 5 [1Q]
# Key:       Region, State, Purpose [304]
   Quarter Region   State           Purpose  Trips
     &lt;qtr&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;
 1 1998 Q1 Adelaide South Australia Business  135.
 2 1998 Q2 Adelaide South Australia Business  110.
 3 1998 Q3 Adelaide South Australia Business  166.
 4 1998 Q4 Adelaide South Australia Business  127.
 5 1999 Q1 Adelaide South Australia Business  137.
 6 1999 Q2 Adelaide South Australia Business  200.
 7 1999 Q3 Adelaide South Australia Business  169.
 8 1999 Q4 Adelaide South Australia Business  134.
 9 2000 Q1 Adelaide South Australia Business  154.
10 2000 Q2 Adelaide South Australia Business  169.
# ℹ 24,310 more rows</code></pre>
</div>
</div>
<ul>
<li><p>A <code>tsibble</code> allows storage and manipulation of multiple time series in R</p></li>
<li><p>It contains:</p>
<ul>
<li><p>An index: time information about the observation</p></li>
<li><p>Measured variable(s): numbers of interest</p></li>
<li><p>Key variable(s): optional unique identifiers for each series</p></li>
</ul></li>
<li><p>It works with <code>tidyverse</code> functions</p></li>
</ul>
<p>To create a <code>tsibble</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">123</span>, <span class="dv">39</span>, <span class="dv">78</span>, <span class="dv">52</span>, <span class="dv">110</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> year</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>mydata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 5 x 2 [1Y]
   year     y
  &lt;int&gt; &lt;dbl&gt;
1  2015   123
2  2016    39
3  2017    78
4  2018    52
5  2019   110</code></pre>
</div>
</div>
<p>Converting an existing data frame (or <code>tibble</code>) into a <code>tsibble</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">123</span>, <span class="dv">39</span>, <span class="dv">78</span>, <span class="dv">52</span>, <span class="dv">110</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> year)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>mydata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 5 x 2 [1Y]
   year     y
  &lt;int&gt; &lt;dbl&gt;
1  2015   123
2  2016    39
3  2017    78
4  2018    52
5  2019   110</code></pre>
</div>
</div>
<p>For observations more frequent than once per year, we need to use a time class function on the index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Month =</span> <span class="fu">c</span>(<span class="st">"2019 Jan"</span>, <span class="st">"2019 Feb"</span>, <span class="st">"2019 Mar"</span>, <span class="st">"2019 Apr"</span>, <span class="st">"2019 May"</span>),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Observation =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">23</span>, <span class="dv">34</span>, <span class="dv">30</span>, <span class="dv">25</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Month    Observation
  &lt;chr&gt;          &lt;dbl&gt;
1 2019 Jan          50
2 2019 Feb          23
3 2019 Mar          34
4 2019 Apr          30
5 2019 May          25</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>z <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">yearmonth</span>(Month)) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 5 x 2 [1M]
       Month Observation
       &lt;mth&gt;       &lt;dbl&gt;
1 2019 janv.          50
2 2019 févr.          23
3  2019 mars          34
4  2019 avr.          30
5   2019 mai          25</code></pre>
</div>
</div>
<p>Common time index variables can be created with these functions:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Frequency</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Quarterly</td>
<td><code>yearquarter()</code></td>
</tr>
<tr class="even">
<td>Monthly</td>
<td><code>yearmonth()</code></td>
</tr>
<tr class="odd">
<td>Weekly</td>
<td><code>yearweek()</code></td>
</tr>
<tr class="even">
<td>Daily</td>
<td><code>as_date()</code>, <code>ymd()</code></td>
</tr>
<tr class="odd">
<td>Sub-daily</td>
<td><code>as_datetime()</code></td>
</tr>
</tbody>
</table>
<p><strong>Australian prison population dataset</strong></p>
<p>Read a csv file and convert to a tsibble</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>prison <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/prison_population.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3072 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): state, gender, legal, indigenous
dbl  (1): count
date (1): date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>prison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,072 × 6
   date       state gender legal     indigenous count
   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;
 1 2005-03-01 ACT   Female Remanded  ATSI           0
 2 2005-03-01 ACT   Female Remanded  Other          2
 3 2005-03-01 ACT   Female Sentenced ATSI           0
 4 2005-03-01 ACT   Female Sentenced Other          0
 5 2005-03-01 ACT   Male   Remanded  ATSI           7
 6 2005-03-01 ACT   Male   Remanded  Other         58
 7 2005-03-01 ACT   Male   Sentenced ATSI           0
 8 2005-03-01 ACT   Male   Sentenced Other          0
 9 2005-03-01 NSW   Female Remanded  ATSI          51
10 2005-03-01 NSW   Female Remanded  Other        131
# ℹ 3,062 more rows</code></pre>
</div>
</div>
<p>The observations are in fact quarterly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>prison <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 1
  month
  &lt;dbl&gt;
1     3
2     6
3     9
4    12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>prison <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Quarter =</span> <span class="fu">yearquarter</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> Quarter,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="fu">c</span>(state, gender, legal, indigenous)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 3,072 x 6 [1Q]
# Key:       state, gender, legal, indigenous [64]
   state gender legal    indigenous count Quarter
   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;   &lt;qtr&gt;
 1 ACT   Female Remanded ATSI           0 2005 Q1
 2 ACT   Female Remanded ATSI           1 2005 Q2
 3 ACT   Female Remanded ATSI           0 2005 Q3
 4 ACT   Female Remanded ATSI           0 2005 Q4
 5 ACT   Female Remanded ATSI           1 2006 Q1
 6 ACT   Female Remanded ATSI           1 2006 Q2
 7 ACT   Female Remanded ATSI           1 2006 Q3
 8 ACT   Female Remanded ATSI           0 2006 Q4
 9 ACT   Female Remanded ATSI           0 2007 Q1
10 ACT   Female Remanded ATSI           1 2007 Q2
# ℹ 3,062 more rows</code></pre>
</div>
</div>
<p><strong>Australian Pharmaceutical Benefits Scheme</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>PBS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 67,596 x 9 [1M]
# Key:       Concession, Type, ATC1, ATC2 [336]
        Month Concession   Type    ATC1  ATC1_desc ATC2  ATC2_desc Scripts  Cost
        &lt;mth&gt; &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 1991 juil. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   18228 67877
 2  1991 août Concessional Co-pay… A     Alimenta… A01   STOMATOL…   15327 57011
 3 1991 sept. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   14775 55020
 4  1991 oct. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   15380 57222
 5  1991 nov. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   14371 52120
 6  1991 déc. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   15028 54299
 7 1992 janv. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   11040 39753
 8 1992 févr. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   15165 54405
 9  1992 mars Concessional Co-pay… A     Alimenta… A01   STOMATOL…   16898 61108
10  1992 avr. Concessional Co-pay… A     Alimenta… A01   STOMATOL…   18141 65356
# ℹ 67,586 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>PBS <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ATC2 <span class="sc">==</span> <span class="st">"A10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Month, Concession, Type, Cost) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TotalC =</span> <span class="fu">sum</span>(Cost))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 204 x 2 [1M]
        Month  TotalC
        &lt;mth&gt;   &lt;dbl&gt;
 1 1991 juil. 3526591
 2  1991 août 3180891
 3 1991 sept. 3252221
 4  1991 oct. 3611003
 5  1991 nov. 3565869
 6  1991 déc. 4306371
 7 1992 janv. 5088335
 8 1992 févr. 2814520
 9  1992 mars 2985811
10  1992 avr. 3204780
# ℹ 194 more rows</code></pre>
</div>
</div>
<p>No need to group by month, since this in inherent to the index variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="ot">&lt;-</span> PBS <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ATC2 <span class="sc">==</span> <span class="st">"A10"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Month, Concession, Type, Cost) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">TotalC =</span> <span class="fu">sum</span>(Cost)) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cost =</span> TotalC <span class="sc">/</span> <span class="fl">1e6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Olympic running</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>olympic_running</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 312 x 4 [4Y]
# Key:       Length, Sex [14]
    Year Length Sex    Time
   &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1  1896    100 men    12  
 2  1900    100 men    11  
 3  1904    100 men    11  
 4  1908    100 men    10.8
 5  1912    100 men    10.8
 6  1916    100 men    NA  
 7  1920    100 men    10.8
 8  1924    100 men    10.6
 9  1928    100 men    10.8
10  1932    100 men    10.3
# ℹ 302 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>olympic_running <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 1
  Sex  
  &lt;chr&gt;
1 men  
2 women</code></pre>
</div>
</div>
<p><strong>The seasonal period</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Data</th>
<th>Minute</th>
<th>Hour</th>
<th>Day</th>
<th>Week</th>
<th>Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Quarters</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>4</td>
</tr>
<tr class="even">
<td>Months</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>12</td>
</tr>
<tr class="odd">
<td>Weeks</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>52</td>
</tr>
<tr class="even">
<td>Days</td>
<td></td>
<td></td>
<td></td>
<td>7</td>
<td>365.25</td>
</tr>
<tr class="odd">
<td>Hours</td>
<td></td>
<td></td>
<td>24</td>
<td>168</td>
<td>8766</td>
</tr>
<tr class="even">
<td>Minutes</td>
<td></td>
<td>60</td>
<td>1440</td>
<td>10080</td>
<td>525960</td>
</tr>
<tr class="odd">
<td>Seconds</td>
<td>60</td>
<td>3600</td>
<td>86400</td>
<td>604800</td>
<td>31557600</td>
</tr>
</tbody>
</table>
</section>
<section id="time-plots" class="level2">
<h2 class="anchored" data-anchor-id="time-plots">2.2 Time plots</h2>
<p><a href="https://otexts.com/fpp3/time-plots.html" class="uri">https://otexts.com/fpp3/time-plots.html</a></p>
<p>Plots allow us to identify:</p>
<ul>
<li><p>Patterns</p></li>
<li><p>Unusual observations</p></li>
<li><p>Changes over time</p></li>
<li><p>Relationships between variables</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"$ (millions)"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Australian antidiabetic drug sales"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = TotalC`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It will pick the first variable it sees - hence select appropriate variables</p>
<p>Points/observations are joint by lines</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> Cost)) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">y =</span> Cost)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Cost) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Cost) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Antidiabetic drug sales"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$ million"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ansett</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 7,407 x 4 [1W]
# Key:       Airports, Class [30]
       Week Airports Class    Passengers
     &lt;week&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;dbl&gt;
 1 1989 W28 ADL-PER  Business        193
 2 1989 W29 ADL-PER  Business        254
 3 1989 W30 ADL-PER  Business        185
 4 1989 W31 ADL-PER  Business        254
 5 1989 W32 ADL-PER  Business        191
 6 1989 W33 ADL-PER  Business        136
 7 1989 W34 ADL-PER  Business          0
 8 1989 W35 ADL-PER  Business          0
 9 1989 W36 ADL-PER  Business          0
10 1989 W37 ADL-PER  Business          0
# ℹ 7,397 more rows</code></pre>
</div>
</div>
<ul>
<li><p>Weekly data</p></li>
<li><p>4 variables</p></li>
<li><p>2 keys: Airports, Class</p></li>
<li><p>1 time index</p></li>
<li><p>1 passengers</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ansett <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(Passengers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ansett <span class="sc">|&gt;</span> <span class="fu">distinct</span>(Class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  Class   
  &lt;chr&gt;   
1 Business
2 Economy 
3 First   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ansett <span class="sc">|&gt;</span> <span class="fu">distinct</span>(Airports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
   Airports
   &lt;chr&gt;   
 1 ADL-PER 
 2 MEL-ADL 
 3 MEL-BNE 
 4 MEL-OOL 
 5 MEL-PER 
 6 MEL-SYD 
 7 SYD-ADL 
 8 SYD-BNE 
 9 SYD-OOL 
10 SYD-PER </code></pre>
</div>
</div>
<p>10 airports * 3 classes = 30 unique time series</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ansett <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Economy"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = Passengers`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>melsyd_economy <span class="ot">&lt;-</span> ansett <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Airports <span class="sc">==</span> <span class="st">"MEL-SYD"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Airports)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>melsyd_economy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 740 x 3 [1W]
# Key:       Class [3]
       Week Class    Passengers
     &lt;week&gt; &lt;chr&gt;         &lt;dbl&gt;
 1 1989 W28 Business       1524
 2 1989 W29 Business       2212
 3 1989 W30 Business       1777
 4 1989 W31 Business       2552
 5 1989 W32 Business       1889
 6 1989 W33 Business        851
 7 1989 W34 Business          0
 8 1989 W35 Business          0
 9 1989 W36 Business          0
10 1989 W37 Business          0
# ℹ 730 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>melsyd_economy <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = Passengers`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>melsyd_economy <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Class <span class="sc">==</span> <span class="st">"Economy"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Passengers =</span> Passengers <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Passengers) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Ansett airlines economy class"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Melbourne-Sydney"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Passengers ('000)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-patterns" class="level2">
<h2 class="anchored" data-anchor-id="time-series-patterns">2.3 Time series patterns</h2>
<p><a href="https://otexts.com/fpp3/tspatterns.html" class="uri">https://otexts.com/fpp3/tspatterns.html</a></p>
<ul>
<li><p><strong>Trend</strong>: pattern exists when there is a long-term increase or decrease in the data</p></li>
<li><p><strong>Seasonal</strong>: pattern exists when a series is influenced by seasonal factors (e.g.&nbsp;the quarter of the year, the month, or day of the week)</p></li>
<li><p><strong>Cyclic</strong>: pattern exists when data exhibit rises and falls that are <em>not of fixed period</em> (duration usually of at least 2 years).</p></li>
</ul>
<p>Differences between seasonal and cyclic patterns:</p>
<ul>
<li><p>seasonal pattern constant length; cyclic pattern variable length</p></li>
<li><p>average length of cycle longer than length of seasonal pattern</p></li>
<li><p>magnitude of cycle more variable than magnitude of seasonal pattern</p></li>
</ul>
<p>The timing of peaks and troughs is predictable with seasonal data, but unpredictable in the long term with cyclic data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1980</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Electricity) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"GWh"</span>, <span class="at">title =</span> <span class="st">"Australian electricity production"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Trend: long term increase</p></li>
<li><p>Seasonal: regular peaks every 4 observations</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Bricks) <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"million units"</span>, <span class="at">title =</span> <span class="st">"Australian clay brick production"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 20 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>mid 50s to mid 70s: increase in trend</p></li>
<li><p>recession early 80s</p></li>
<li><p>cyclical pattern after the 80s</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>us_employment <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Title <span class="sc">==</span> <span class="st">"Retail Trade"</span>, <span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1980</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Employed <span class="sc">/</span> <span class="fl">1e3</span>) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Million people"</span>, <span class="at">title =</span> <span class="st">"Retail employment, USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Peak in the summer months</p></li>
<li><p>Cyclical features</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>gafa_stock <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"AMZN"</span>, <span class="fu">year</span>(Date) <span class="sc">&gt;=</span> <span class="dv">2018</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Close) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"$US"</span>, <span class="at">title =</span> <span class="st">"Amazon closing stock price"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Financial data</p></li>
<li><p>Wandering behaviour (random walk)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pelt <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Lynx) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Number trapped"</span>, <span class="at">title =</span> <span class="st">"Annual Canadian Lynx Trappings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Annual data does not have seasonality</li>
</ul>
</section>
<section id="seasonal-plots" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-plots">2.4 Seasonal plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Cost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Seasonal plot: the data are plotted against the individual “seasons” in which the data were observed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Cost, <span class="at">labels =</span> <span class="st">"both"</span>) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"$ million"</span>, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Seasonal plot: antidiabetic drug sales"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Data plotted against the individual “seasons” in which the data were observed (in this case a “season” is a month</p></li>
<li><p>Something like a time plot except that the data from each season are overlapped</p></li>
<li><p>Enables the underlying seasonal pattern to be seen more clearly, and also allows any substantial departures from the seasonal pattern to be easily identified.</p></li>
<li><p>In R: <code>gg_season()</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>beer <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Quarter, Beer) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>beer <span class="sc">|&gt;</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Beer) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Australian beer production"</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Megalitres"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>beer <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Beer) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Australian beer production"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Megalitres"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>beer <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Beer, <span class="at">labels =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>vic_elec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 52,608 x 5 [30m] &lt;Australia/Melbourne&gt;
   Time                Demand Temperature Date       Holiday
   &lt;dttm&gt;               &lt;dbl&gt;       &lt;dbl&gt; &lt;date&gt;     &lt;lgl&gt;  
 1 2012-01-01 00:00:00  4383.        21.4 2012-01-01 TRUE   
 2 2012-01-01 00:30:00  4263.        21.0 2012-01-01 TRUE   
 3 2012-01-01 01:00:00  4049.        20.7 2012-01-01 TRUE   
 4 2012-01-01 01:30:00  3878.        20.6 2012-01-01 TRUE   
 5 2012-01-01 02:00:00  4036.        20.4 2012-01-01 TRUE   
 6 2012-01-01 02:30:00  3866.        20.2 2012-01-01 TRUE   
 7 2012-01-01 03:00:00  3694.        20.1 2012-01-01 TRUE   
 8 2012-01-01 03:30:00  3562.        19.6 2012-01-01 TRUE   
 9 2012-01-01 04:00:00  3433.        19.1 2012-01-01 TRUE   
10 2012-01-01 04:30:00  3359.        19.0 2012-01-01 TRUE   
# ℹ 52,598 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>vic_elec <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = Demand`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>vic_elec <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Demand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>vic_elec <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Demand, <span class="at">period =</span> <span class="st">"week"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>vic_elec <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Demand, <span class="at">period =</span> <span class="st">"day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seasonal-subseries-plots" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-subseries-plots">2.5 Seasonal subseries plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>a10 <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Cost) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"$ (millions)"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Australian antidiabetic drug sales"</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Data for each season collected together in time plot as separate time series</p></li>
<li><p>Enables the underlying seasonal pattern to be seen clearly, and changes in seasonality over time to be visualized</p></li>
<li><p>In R: <code>gg_subseries()</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>beer <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Quarter, Beer) <span class="sc">|&gt;</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>beer <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(Beer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>beer <span class="sc">|&gt;</span> <span class="fu">gg_subseries</span>(Beer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The global downward trend is due to a decrease in Q4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>holidays <span class="ot">&lt;-</span> tourism <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Purpose <span class="sc">==</span> <span class="st">"Holiday"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Trips =</span> <span class="fu">sum</span>(Trips))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>holidays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 640 x 3 [1Q]
# Key:       State [8]
   State Quarter Trips
   &lt;chr&gt;   &lt;qtr&gt; &lt;dbl&gt;
 1 ACT   1998 Q1  196.
 2 ACT   1998 Q2  127.
 3 ACT   1998 Q3  111.
 4 ACT   1998 Q4  170.
 5 ACT   1999 Q1  108.
 6 ACT   1999 Q2  125.
 7 ACT   1999 Q3  178.
 8 ACT   1999 Q4  218.
 9 ACT   2000 Q1  158.
10 ACT   2000 Q2  155.
# ℹ 630 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>holidays <span class="sc">|&gt;</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Trips) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Overnight trips ('000)"</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Australian domestic holidays"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>holidays <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(Trips) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(State), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"thousands of trips"</span>, </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Australian domestic holiday nights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>holidays <span class="sc">|&gt;</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(Trips) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"thousands of trips"</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Australian domestic holiday nights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scatter-plots" class="level2">
<h2 class="anchored" data-anchor-id="scatter-plots">2.6 Scatter plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>vic_elec_day_type <span class="ot">&lt;-</span> vic_elec <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Time) <span class="sc">==</span> <span class="dv">2014</span>) <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Day_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    Holiday <span class="sc">~</span> <span class="st">"Holiday"</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">wday</span>(Date) <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"Weekday"</span>,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">"Weekend"</span>))</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>vic_elec_day_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 17,520 x 6 [30m] &lt;Australia/Melbourne&gt;
   Time                Demand Temperature Date       Holiday Day_type
   &lt;dttm&gt;               &lt;dbl&gt;       &lt;dbl&gt; &lt;date&gt;     &lt;lgl&gt;   &lt;chr&gt;   
 1 2014-01-01 00:00:00  4092.        18.7 2014-01-01 TRUE    Holiday 
 2 2014-01-01 00:30:00  4198.        18.1 2014-01-01 TRUE    Holiday 
 3 2014-01-01 01:00:00  3915.        18.2 2014-01-01 TRUE    Holiday 
 4 2014-01-01 01:30:00  3673.        17.9 2014-01-01 TRUE    Holiday 
 5 2014-01-01 02:00:00  3498.        17.6 2014-01-01 TRUE    Holiday 
 6 2014-01-01 02:30:00  3339.        16.8 2014-01-01 TRUE    Holiday 
 7 2014-01-01 03:00:00  3204.        16.3 2014-01-01 TRUE    Holiday 
 8 2014-01-01 03:30:00  3100.        16.6 2014-01-01 TRUE    Holiday 
 9 2014-01-01 04:00:00  3039.        16.6 2014-01-01 TRUE    Holiday 
10 2014-01-01 04:30:00  3012.        16.7 2014-01-01 TRUE    Holiday 
# ℹ 17,510 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>vic_elec_day_type <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temperature, <span class="at">y =</span> Demand)) <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (degrees Celsius)"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Electricity Demand (GW)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>vic_elec_day_type <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Temperature, <span class="at">y =</span> Demand, <span class="at">color =</span> Day_type)) <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (degrees Celsius)"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Electricity Demand (GW)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Correlation coefficient: measures the extent of a linear relationship between two variables (y and x)</p>
<ul>
<li><p><span class="math display">\[
r=\frac{\sum^T_{t=1}(y_t-\bar{y})(x_t-\bar{x})}{\sqrt{\sum^T_{t=1}(y-\bar{y})^2}\sqrt{\sum^T_{t=1}(x-\bar{x})^2}}
\]</span></p></li>
<li><p>lies between -1 and 1</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>us_change <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>visitors <span class="ot">&lt;-</span> tourism <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Trips =</span> <span class="fu">sum</span>(Trips))</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>visitors <span class="sc">|&gt;</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter, <span class="at">y =</span> Trips)) <span class="sc">+</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(State), <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Australian domestic tourism"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span> <span class="st">"Overnight trips ('000)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>visitors <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Trips, <span class="at">names_from=</span>State) <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lag-plots" class="level2">
<h2 class="anchored" data-anchor-id="lag-plots">2.7 Lag plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>new_production</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 74 x 7 [1Q]
   Quarter  Beer Tobacco Bricks Cement Electricity   Gas
     &lt;qtr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 1992 Q1   443    5777    383   1289       38332   117
 2 1992 Q2   410    5853    404   1501       39774   151
 3 1992 Q3   420    6416    446   1539       42246   175
 4 1992 Q4   532    5825    420   1568       38498   129
 5 1993 Q1   433    5724    394   1450       39460   116
 6 1993 Q2   421    6036    462   1668       41356   149
 7 1993 Q3   410    6570    475   1648       42949   163
 8 1993 Q4   512    5675    443   1863       40974   138
 9 1994 Q1   449    5311    421   1468       40162   127
10 1994 Q2   381    5717    475   1755       41199   159
# ℹ 64 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(Beer, <span class="at">geom =</span> <span class="st">"point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Each graph shows <span class="math inline">\(y_t\)</span> plotted against <span class="math inline">\(y_{t-k}\)</span> for different values of <span class="math inline">\(k\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(Beer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="autocorrelation">2.8 Autocorrelation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_lag</span>(Beer, <span class="at">geom =</span> <span class="st">"point"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Each graph shows <span class="math inline">\(y_t\)</span> plotted against <span class="math inline">\(y_{t-k}\)</span> for different values of <span class="math inline">\(k\)</span>.</p></li>
<li><p>The autocorrelations are the correlations associated with these scatterplots.</p></li>
<li><p><span class="math inline">\(r_1=corr(y_t,y_{t-1})\)</span></p></li>
<li><p><span class="math inline">\(r_2=corr(y_t,y_{t-2})\)</span></p></li>
<li><p><span class="math inline">\(r_3=corr(y_t,y_{t-3})\)</span></p></li>
<li><p>…</p></li>
</ul>
<p>We denote the sample autocovariance at lag <span class="math inline">\(k\)</span> by <span class="math inline">\(c_k\)</span> and the sample autocorrelation at lag <span class="math inline">\(k\)</span> by <span class="math inline">\(r_k\)</span>. Then define:</p>
<p><span class="math display">\[
c_k=\frac{1}{T}\sum^T_{t=k+1}(y_t-\bar{y})(y_{t-k}-\bar{y})
\]</span></p>
<p>and</p>
<p><span class="math display">\[
r_k=\frac{c_k}{c_0}
\]</span></p>
<p>or</p>
<p><span class="math display">\[
r_k=\frac{\sum^T_{t=k+1}(y_t-\bar{y})(y_{t-k}-\bar{y})}{\sum^T_{t=1}(y_t-\bar{y})^2}
\]</span></p>
<ul>
<li><p><span class="math inline">\(r_1\)</span> indicates how successive values of <span class="math inline">\(y\)</span> relate to each other</p></li>
<li><p><span class="math inline">\(r_2\)</span> indicates how <span class="math inline">\(y\)</span> values two periods apart relate to each other</p></li>
<li><p><span class="math inline">\(r_k\)</span> is almost the same as the samle correlation between <span class="math inline">\(y\)</span> and <span class="math inline">\(y-k\)</span></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer, <span class="at">lag_max =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 9 x 2 [1Q]
       lag     acf
  &lt;cf_lag&gt;   &lt;dbl&gt;
1       1Q -0.102 
2       2Q -0.657 
3       3Q -0.0603
4       4Q  0.869 
5       5Q -0.0892
6       6Q -0.635 
7       7Q -0.0542
8       8Q  0.832 
9       9Q -0.108 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer, <span class="at">lag_max =</span> <span class="dv">9</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Together, the autocorrelations at lags 1, 2, …, make up the <em>autocorrelation</em> or ACF.</p></li>
<li><p>The plot is known as a <strong>correlogram</strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>new_production <span class="sc">|&gt;</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Beer) <span class="sc">|&gt;</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><span class="math inline">\(r_4\)</span> is higher than for the other lags due to <strong>the seasonal pattern in the data</strong>: peaks tend to be <strong>4 quarters</strong> apart and troughs tend to be <strong>4 quarters</strong> apart.</p></li>
<li><p><span class="math inline">\(r_2\)</span> is more negative than for the other lags because troughs tend to be 2 quarters behind peaks.</p></li>
<li><p>When data have a trend, the autocorrelations for small lags tend to be large and positive (because observations nearby in time are also nearby in value)</p></li>
<li><p>When data are seasonal, the autocorrelations will be larger at the seasonal lags (i.e.&nbsp;at multiples of the seasonal frequency)</p></li>
<li><p>When data are trended and seasonal, you see a combination of these effects</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> us_employment <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Title <span class="sc">==</span> <span class="st">"Retail Trade"</span>, <span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1980</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>retail <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(Employed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Trend + seasonal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>retail <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Employed, <span class="at">lag_max =</span> <span class="dv">48</span>) <span class="sc">|&gt;</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="ot">&lt;-</span> gafa_stock <span class="sc">|&gt;</span> </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>, <span class="fu">year</span>(Date) <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Date, Close)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>google_2015</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 252 x 2 [!]
   Date       Close
   &lt;date&gt;     &lt;dbl&gt;
 1 2015-01-02  522.
 2 2015-01-05  511.
 3 2015-01-06  499.
 4 2015-01-07  498.
 5 2015-01-08  500.
 6 2015-01-09  493.
 7 2015-01-12  490.
 8 2015-01-13  493.
 9 2015-01-14  498.
10 2015-01-15  499.
# ℹ 242 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(Close)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Close, <span class="at">lag_max =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Provided data has an irregular interval, results should be treated
with caution. Computing ACF by observation.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 100 x 2 [1]
        lag   acf
   &lt;cf_lag&gt; &lt;dbl&gt;
 1        1 0.982
 2        2 0.959
 3        3 0.937
 4        4 0.918
 5        5 0.901
 6        6 0.883
 7        7 0.865
 8        8 0.849
 9        9 0.834
10       10 0.818
# ℹ 90 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>google_2015 <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Close, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Provided data has an irregular interval, results should be treated
with caution. Computing ACF by observation.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="white-noise" class="level2">
<h2 class="anchored" data-anchor-id="white-noise">2.9 White noise</h2>
<p>White noise contains all the frequencies in the spectrum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">30</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>wn <span class="ot">&lt;-</span> <span class="fu">tsibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>), <span class="at">index =</span> t)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>wn <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = y`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>White noise data is uncorrelated across time with zero mean and constant variance.</p>
<p>(Technically, we require independence as well).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>wn <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">y =</span> ,<span class="at">lag_max =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Response variable not specified, automatically selected `var = y`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 10 x 2 [1]
        lag     acf
   &lt;cf_lag&gt;   &lt;dbl&gt;
 1        1  0.0138
 2        2 -0.163 
 3        3  0.163 
 4        4 -0.259 
 5        5 -0.198 
 6        6  0.0642
 7        7 -0.139 
 8        8 -0.0316
 9        9  0.199 
10       10 -0.0240</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>wn <span class="sc">|&gt;</span> <span class="fu">ACF</span>(y) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Sample autocorrelations for white noise series</p></li>
<li><p>Expect each autocorrelation to be close to zero</p></li>
<li><p>Blue lines show 95% critical values</p></li>
</ul>
<p>Sampling distribution of <span class="math inline">\(r_k\)</span> for white noise data is asymptotically <span class="math inline">\(N(0,1/T)\)</span></p>
<ul>
<li><p>95% of all <span class="math inline">\(r_k\)</span> for white noise must lie within <span class="math inline">\(\pm1.96/\sqrt{T}\)</span></p></li>
<li><p>If this is not the case, the series is probably not white noise</p></li>
<li><p>Common to plot lines at <span class="math inline">\(\pm1.96/\sqrt{T}\)</span> when plotting ACF. These are the <strong>critical values</strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>pigs <span class="ot">&lt;-</span> aus_livestock <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"Victoria"</span>, Animal <span class="sc">==</span> <span class="st">"Pigs"</span>, <span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">2014</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>pigs <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(Count <span class="sc">/</span> <span class="fl">1e3</span>) <span class="sc">+</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Thousands"</span>, <span class="at">title =</span> <span class="st">"Number of pigs slaughtered in Victoria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>pigs <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(Count) <span class="sc">|&gt;</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Difficult to detect pattern in time plot</p></li>
<li><p>ACF shows significant autocorrelation for lags 2 and 12</p></li>
<li><p>Indicates some slight seasonality</p></li>
</ul>
<p>These show the series is not a white noise series.</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">2.10 Exercises</h2>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">2.11 Further reading</h2>
</section>
</section>
<section id="chapter-3---time-series-decomposition" class="level1">
<h1>Chapter 3 - Time series decomposition</h1>
<p>3 types of time series patterns: trend, seasonality and cycles.</p>
<p>When we decompose a time series into components, we usually combine the trend and cycle into a single <strong>trend-cycle</strong> component (often just called the <strong>trend</strong> for simplicity). Thus we can think of a time series as comprising three components:</p>
<ul>
<li><p>a trend-cycle component</p></li>
<li><p>a seasonal component</p></li>
<li><p>a remainder component</p></li>
</ul>
<p>For some time series (e.g.&nbsp;those that are observed at least daily), there can be more than one seasonal component, corresponding to the different seasonal periods.</p>
<section id="transformations-and-adjustments" class="level2">
<h2 class="anchored" data-anchor-id="transformations-and-adjustments">3.1 Transformations and adjustments</h2>
<p><strong>Par capita adjustments</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>global_economy <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Australia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(GDP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>global_economy <span class="sc">|&gt;</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Australia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(GDP <span class="sc">/</span> Population)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Inflation adjustments</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>print_retail <span class="ot">&lt;-</span> aus_retail <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Industry <span class="sc">==</span> <span class="st">"Newspaper and book retailing"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Industry) <span class="sc">|&gt;</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">Year =</span>  <span class="fu">year</span>(Month)) <span class="sc">|&gt;</span> </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Turnover =</span> <span class="fu">sum</span>(Turnover))</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>aus_economy <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span> </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">"AUS"</span>)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>print_retail <span class="sc">|&gt;</span> </span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(aus_economy, <span class="at">by =</span> <span class="st">"Year"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Adjusted_turnover =</span> Turnover <span class="sc">/</span> CPI <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Turnover, Adjusted_turnover),</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Turnover"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Turnover"</span>, <span class="st">"Adjusted_turnover"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Turnover)) <span class="sc">+</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Turnover: Australian print media industry"</span>, <span class="at">y =</span> <span class="st">"$AU"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Mathematical transformations</strong></p>
<p>If the data show different variations at different levels of the series, then a transformation can be useful.</p>
<p>Denote original observations as <span class="math inline">\(y_1, ..., y_T\)</span> and transformed observations as <span class="math inline">\(w_1, ..., w_T\)</span>.</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td>Square root</td>
<td><span class="math inline">\(w_t=\sqrt{y_t}\)</span></td>
<td>⬊</td>
</tr>
<tr class="even">
<td>Cube root</td>
<td><span class="math inline">\(w_t=\sqrt[3]{y_t}\)</span></td>
<td>increasing</td>
</tr>
<tr class="odd">
<td>Logarithm</td>
<td><span class="math inline">\(w_t=log(y_t)\)</span></td>
<td>strength</td>
</tr>
</tbody>
</table>
<p>Logarithms, in particular, are useful because they are more interpretable: changes in a log value are <strong>relative (percent) changes on the original scale</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>food <span class="ot">&lt;-</span> aus_retail <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Industry <span class="sc">==</span> <span class="st">"Food retailing"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Turnover =</span> <span class="fu">sum</span>(Turnover))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Turnover) <span class="sc">+</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Turnover ($AUD)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">sqrt</span>(Turnover)) <span class="sc">+</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Square root turnover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Turnover<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cube root turnover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">log</span>(Turnover)) <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Log turnover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> Turnover) <span class="sc">+</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Inverse turnover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Each of these transformations is close to a member of the family of <strong>Box-Cox transformations</strong>:</p>
<p><span class="math display">\[
w_t = \left\{\begin{array}{ll}
        \log(y_t),      &amp; \quad \lambda = 0; \\
        (sign(y_t)|y_t|^\lambda-1)/\lambda ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<p>Actually the Bickel-Doksum transformation (allowing for <span class="math inline">\(y_t&lt;0\)</span>:</p>
<ul>
<li><p><span class="math inline">\(\lambda=1\)</span>: no substantive transformation</p></li>
<li><p><span class="math inline">\(\lambda=\frac{1}{2}\)</span>: square root plus linear transformation</p></li>
<li><p><span class="math inline">\(\lambda=0\)</span>: natural logarithm</p></li>
<li><p><span class="math inline">\(\lambda=-1\)</span>: inverse plus 1</p></li>
</ul>
<p><strong>Box-Cox transformations</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Turnover, <span class="at">features =</span> guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  lambda_guerrero
            &lt;dbl&gt;
1          0.0895</code></pre>
</div>
</div>
<ul>
<li><p>This attempts to balance the seasonal fluctuations and random variations across the series</p></li>
<li><p>Always check the results</p></li>
<li><p>A low value of <span class="math inline">\(\lambda\)</span> can give extremely large prediction intervals</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>food <span class="sc">|&gt;</span> </span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">box_cox</span>(Turnover, <span class="fl">0.0524</span>)) <span class="sc">+</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Box-Cox transformed turnover"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Often no transformation needed</p></li>
<li><p>Simple transformations are easier to explain and work well enough</p></li>
<li><p>Transformations can have very large effect on PI</p></li>
<li><p>If some data are zero or negative, then use <span class="math inline">\(\lambda&gt;0\)</span></p></li>
<li><p><code>log1p()</code> can also be useful for data with zeros</p></li>
<li><p>Choosing logs is a simple way to force forecasts to be positive</p></li>
<li><p>Transformations must be reversed to obtain forecasts on the original scale (handled automatically by <code>fable</code>).</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Gas, <span class="at">features =</span> guerrero) <span class="sc">|&gt;</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">box_cox</span>(Gas, lambda)) <span class="sc">+</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="fu">paste0</span>(</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Transformed gas production with $</span><span class="sc">\\</span><span class="st">lambda$ = "</span>,</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">round</span>(lambda, <span class="dv">2</span>)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>       )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-components" class="level2">
<h2 class="anchored" data-anchor-id="time-series-components">3.2 Time series components</h2>
<p><span class="math display">\[
y_t=f(S_t,T_t,R_t)
\]</span></p>
<p>where:</p>
<p><span class="math inline">\(y_t\)</span> = data at period <span class="math inline">\(t\)</span></p>
<p><span class="math inline">\(T_t\)</span> = trend-cycle component at period <span class="math inline">\(t\)</span></p>
<p><span class="math inline">\(S_t\)</span> = seasonal component at period <span class="math inline">\(t\)</span></p>
<p><span class="math inline">\(R_t\)</span> = remainder component at period <span class="math inline">\(t\)</span></p>
<p><strong>Additive decomposition</strong>: <span class="math inline">\(y_t=S_t+T_t+R_t\)</span></p>
<p><strong>Multiplicative decomposition</strong>: <span class="math inline">\(y_t=S_t \times T_t \times R_t\)</span></p>
<ul>
<li><p>Additive model appropriate if magnitude of seasonal fluctuations does not vary with level</p></li>
<li><p>If seasonal are proportional to level of series, then multiplicative model appropriate</p></li>
<li><p>Multiplicative decomposition more prevalent with economic series</p></li>
<li><p>Alternative: use a Box-Cox transformation, and then use additive decomposition</p></li>
<li><p>Logs turn multiplicative relationship into an additive relationship</p></li>
</ul>
<p><span class="math inline">\(y_t=S_t \times T_t \times R_t\)</span> –&gt; <span class="math inline">\(log(y_t)=log(S_t)+log(T_t)+log(R_t)\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="ot">&lt;-</span> us_employment <span class="sc">|&gt;</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span>, Title <span class="sc">==</span> <span class="st">"Retail Trade"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Series_ID)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>us_retail_employment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 357 x 3 [1M]
        Month Title        Employed
        &lt;mth&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 1990 janv. Retail Trade   13256.
 2 1990 févr. Retail Trade   12966.
 3  1990 mars Retail Trade   12938.
 4  1990 avr. Retail Trade   13012.
 5   1990 mai Retail Trade   13108.
 6  1990 juin Retail Trade   13183.
 7 1990 juil. Retail Trade   13170.
 8  1990 août Retail Trade   13160.
 9 1990 sept. Retail Trade   13113.
10  1990 oct. Retail Trade   13185.
# ℹ 347 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Employed) <span class="sc">+</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Persons (thousands)"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total employment in US retail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(Employed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
      stl
  &lt;model&gt;
1   &lt;STL&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span> us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(Employed))</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 357 x 7 [1M]
# Key:     .model [1]
# :        Employed = trend + season_year + remainder
   .model      Month Employed  trend season_year remainder season_adjust
   &lt;chr&gt;       &lt;mth&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 stl    1990 janv.   13256. 13288.      -33.0      0.836        13289.
 2 stl    1990 févr.   12966. 13269.     -258.     -44.6          13224.
 3 stl     1990 mars   12938. 13250.     -290.     -22.1          13228.
 4 stl     1990 avr.   13012. 13231.     -220.       1.05         13232.
 5 stl      1990 mai   13108. 13211.     -114.      11.3          13223.
 6 stl     1990 juin   13183. 13192.      -24.3     15.5          13207.
 7 stl    1990 juil.   13170. 13172.      -23.2     21.6          13193.
 8 stl     1990 août   13160. 13151.       -9.52    17.8          13169.
 9 stl    1990 sept.   13113. 13131.      -39.5     22.0          13153.
10 stl     1990 oct.   13185. 13110.       61.6     13.2          13124.
# ℹ 347 more rows</code></pre>
</div>
</div>
<p><span class="math display">\[
season\_adjust=y_t-S_t
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Employed, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">components</span>(dcmp), trend, <span class="at">color =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Persons (thousands)"</span>,</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total employment in US retail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(dcmp) <span class="sc">|&gt;</span> <span class="fu">gg_subseries</span>(season_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Useful by-product of decomposition: an easy way to calculate seasonally adjusted data</p></li>
<li><p>Additive decomposition: seasonally adjusted data given by</p></li>
</ul>
<p><span class="math display">\[
y_t-S_t=T_t+R_t
\]</span></p>
<ul>
<li>Multiplicative decomposition: seasonally adjusted data given by</li>
</ul>
<p><span class="math display">\[
y_t/S_t=T_t \times R_t
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Employed, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">components</span>(dcmp), season_adjust, <span class="at">color =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Persons (thousands)"</span>,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total employment in US retail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>We use estimates of <span class="math inline">\(S\)</span> based on past values to seasonally adjust a current value</p></li>
<li><p>Seasonally adjusted series reflect <strong>remainders</strong> as well as <strong>trend</strong>. Therefore they are not “smooth” and “downturns” or “upturns” can be misleading</p></li>
<li><p>It is better to use the trend-cycle component to look for turning points</p></li>
</ul>
</section>
<section id="moving-averages" class="level2">
<h2 class="anchored" data-anchor-id="moving-averages">3.3 Moving averages</h2>
<p>The simplest estimate of the trend-cycle uses <strong>moving averages</strong></p>
<p><span class="math display">\[
\hat{T}_t = \frac{1}{m} \sum_{j=-k}^k y_{t+j}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
k=\frac{m-1}{2}
\]</span></p>
<p>Example with <span class="math inline">\(m=7\)</span>:</p>
<p><span class="math display">\[
k=\frac{m-1}{2}=\frac{7-1}{2}=3
\]</span></p>
<p>7-MA (Month Average):</p>
<p><span class="math display">\[
\hat{T}_t = \frac{1}{7} \sum_{j=-3}^3 y_{t+j}
\]</span></p>
<p><span class="math display">\[
\hat{T}_t=\frac{1}{7}(y_{t-3}+y_{t-2}+y_{t-1}+y_t+y_{t+1}+y_{t+2}+y_{t+3})
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>global_economy <span class="sc">|&gt;</span> </span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Australia"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian Exports"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Australia"</span>) <span class="sc">|&gt;</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>      Exports, mean,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">2</span>, <span class="at">.after =</span> <span class="dv">2</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Year, Exports, <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">54</span><span class="sc">:</span><span class="dv">58</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 10 x 4 [1Y]
# Key:       Country [1]
   Country    Year Exports `5-MA`
   &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Australia  1960    13.0   NA  
 2 Australia  1961    12.4   NA  
 3 Australia  1962    13.9   13.5
 4 Australia  1963    13.0   13.5
 5 Australia  1964    14.9   13.6
 6 Australia  2013    20.0   20.8
 7 Australia  2014    21.1   20.4
 8 Australia  2015    20.0   20.3
 9 Australia  2016    19.3   NA  
10 Australia  2017    21.3   NA  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian exports: 5-MA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Australia"</span>) <span class="sc">|&gt;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">3-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>      Exports, mean,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">1</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>      Exports, mean,</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">2</span>, <span class="at">.after =</span> <span class="dv">2</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">7-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>      Exports, mean,</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">3</span>, <span class="at">.after =</span> <span class="dv">3</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">9-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>      Exports, mean,</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">4</span>, <span class="at">.after =</span> <span class="dv">4</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">3-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian exports: 3-MA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian exports: 5-MA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">7-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian exports: 7-MA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>aus_exports <span class="sc">|&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Exports) <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">9-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% of GDP"</span>,</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total Australian exports: 9-MA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 8 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A moving average is a an <strong>average of nearby points</strong>:</p>
<ul>
<li><p>observations nearby in time are also likely to be <strong>close in value</strong></p></li>
<li><p>average eliminates some <strong>randomness</strong> in the data, leaving a smooth trend-cycle component</p></li>
<li><p>each average computed by dropping <strong>oldest</strong> observation and including <strong>next</strong> observation</p></li>
<li><p>averages <strong>moves</strong> through time series until trend-cycle computed at each observation possible</p></li>
</ul>
<p>Why is there no estimates at end?</p>
<ul>
<li><p>For a 3-MA, there cannot be estimates at time 1 or time T because the observations at time 0 and T+1 are not available</p></li>
<li><p>Generally: there cannot be estimates at times near the endpoints</p></li>
</ul>
<p>The order of the MA</p>
<ul>
<li><p>larger order means smoother, flatter curve</p></li>
<li><p>larger order means more points lost at ends</p></li>
<li><p><strong>order = length of season</strong> <em>or</em> cycle removes pattern</p></li>
<li><p>but so far odd orders?</p></li>
</ul>
<p>For even orders:</p>
<ul>
<li>4-MA:</li>
</ul>
<p><span class="math display">\[
\frac{1}{4}(y_{t-2}+y_{t-1}+y_t+y_{t+1})
\]</span></p>
<p>or</p>
<p><span class="math display">\[
\frac{1}{4}(y_{t-1}+y_t+y_{t+1}+y_{t+2})
\]</span></p>
<p>In this case, the data aren’t centered. Solution: take a further 2-MA to “centre” the result.</p>
<p><span class="math display">\[
\hat{T}_t=\frac{1}{2}\{\frac{1}{4}(y_{t-2}+y_{t-1}+y_t+y_{t+1})+\frac{1}{4}(y_{t-1}+y_t+y_{t+1}+y_{t+2})\}=\frac{1}{8}y_{t-2}+\frac{1}{4}y_{t-1}+\frac{1}{4}y_t+\frac{1}{4}y_{t+1}+\frac{1}{8}y_{t+2}
\]</span></p>
<p>A moving average of the same length as the season removes the seasonal pattern:</p>
<ul>
<li><p>For quarterly data, use a <span class="math inline">\(2 \times 4\ MA\)</span></p></li>
<li><p>For monthly data, use a <span class="math inline">\(2 \times 12\ MA\)</span></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>beer <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>) <span class="sc">|&gt;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Quarter, Beer)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>beer_ma <span class="ot">&lt;-</span> beer <span class="sc">|&gt;</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">4-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(Beer, mean,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">2</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2x4-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(<span class="st">`</span><span class="at">4-MA</span><span class="st">`</span>, mean,</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">0</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment_ma <span class="ot">&lt;-</span> us_retail_employment <span class="sc">|&gt;</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">12-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(Employed, mean,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.before =</span> <span class="dv">5</span>, <span class="at">.after =</span> <span class="dv">6</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>),</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2x12-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(<span class="st">`</span><span class="at">12-MA</span><span class="st">`</span>, mean,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">.before =</span> <span class="dv">1</span>, <span class="at">.after =</span> <span class="dv">0</span>, <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>us_retail_employment_ma <span class="sc">|&gt;</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Employed, <span class="at">colour =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">2x12-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Persons (thousands)"</span>,</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Total employment in US retail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 12 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classical-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="classical-decomposition">3.4 Classical decomposition</h2>
<p>Additive decomposition: <span class="math inline">\(y_t=T_t+S_t+R_t=\hat{T_t}+\hat{S_t}+\hat{R_t}\)</span></p>
<p>Multiplicative decomposition: <span class="math inline">\(y_t=T_t \times S_t \times R_t=\hat{T_t} \times \hat{S_t}_ \times \hat{R_t}\)</span></p>
<p><strong>1) Step 1</strong></p>
<p>Estimate <span class="math inline">\(\hat{T}\)</span> using <span class="math inline">\((2 \times m)-MA\)</span> if <span class="math inline">\(m\)</span> is even. Otherwise, estimate <span class="math inline">\(\hat{T}\)</span> using <span class="math inline">\(m-MA\)</span></p>
<p><strong>2) Step 2</strong></p>
<p>Compute de-trended series</p>
<ul>
<li><p>Additive decomposition: <span class="math inline">\(y_t-\hat{T_t}\)</span></p></li>
<li><p>Multiplicative decomposition: <span class="math inline">\(y_t / \hat{T_t}\)</span></p></li>
</ul>
<p>De-trending</p>
<p>Remove smoothed series <span class="math inline">\(\hat{T_t}\)</span> from <span class="math inline">\(y_t\)</span> to leave <span class="math inline">\(S_t\)</span> and <span class="math inline">\(R_t\)</span>.</p>
<ul>
<li><p>Additive model: <span class="math inline">\(y_t-\hat{T_t}=(\hat{T_t}+\hat{S_t}+\hat{R_t})-\hat{T_t}=\hat{S_t}+\hat{R_t}\)</span></p></li>
<li><p>Multiplicative model: <span class="math inline">\(y_t/\hat{T_t}=(\hat{T_t} \times \hat{S_t} \times \hat{R_t})/\hat{T_t}=\hat{S_t} \times \hat{R_t}\)</span></p></li>
</ul>
<p><strong>3) Step 3</strong></p>
<p>Estimating the seasonal component:</p>
<ul>
<li><p>seasonal index for each season is estimated as an <strong>average</strong> of the detrended series for that season of successive years.</p></li>
<li><p>e.g., take averages across all Januaries to get <span class="math inline">\(S^{(1)}\)</span> if your data is monthly.</p></li>
<li><p>If necessary, adjust the seasonal indices so that:</p>
<ul>
<li><p>for additive: <span class="math inline">\(S^{(1)} + S^{(2)} + ... + S^{(12)}=0\)</span></p></li>
<li><p>for multiplicative: <span class="math inline">\(S^{(1)} + S^{(2)} + ... + S^{(12)}=m\)</span></p></li>
</ul></li>
<li><p>The seasonal component <span class="math inline">\(\hat{S_t}\)</span> simply consists of replications of the seasonal indices.</p></li>
</ul>
<p><strong>4) Step 4</strong></p>
<p>Remainder component:</p>
<ul>
<li><p>Additive decomposition: <span class="math inline">\(\hat{R_t}=y_t-\hat{T_t}-\hat{S_t}\)</span></p></li>
<li><p>Multiplicative decomposition: <span class="math inline">\(\hat{R_t}=y_t/(\hat{T_t}\hat{S_t})\)</span></p></li>
</ul>
<p>Classical decomposition:</p>
<ul>
<li><p>Choose additive or multiplicative depending on which gives the most stable components</p></li>
<li><p>For multiplicative models, this method of estimation is known as <strong>ratio-to-moving-average method</strong>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">classical_decomposition</span>(Employed, <span class="at">type =</span> <span class="st">"additive"</span>)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Classical additive decomposition of total US retail employment"</span>, <span class="at">x =</span> <span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">classical_decomposition</span>(Employed, <span class="at">type =</span> <span class="st">"multiplicative"</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Classical multiplicative decomposition of total US retail employment"</span>, <span class="at">x =</span> <span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-110-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Comments on classical decomposition:</p>
<ul>
<li><p>Estimate of trend is <strong>unavailable</strong> for first few and last few observations</p></li>
<li><p><strong>Seasonal component repeats</strong> from year to year. May not be realistic</p></li>
<li><p><strong>Not robust to outliers</strong></p></li>
<li><p>Newer methods designed to overcome these problems.</p></li>
</ul>
</section>
<section id="methods-used-by-official-statistics-agencies" class="level2">
<h2 class="anchored" data-anchor-id="methods-used-by-official-statistics-agencies">3.5 Methods used by official statistics agencies</h2>
<p>History of time series decomposition</p>
<ul>
<li><p>Classical methods originated in the 1920s</p></li>
<li><p>Census II method introduced in 1957. Basis for X-11 method and variants (including X-12-ARIMA, X-13-ARIMA)</p></li>
<li><p>STL method introduced in 1983</p></li>
<li><p>TRAMO/SEATS introduced in the 1990s</p></li>
</ul>
<p>National statistics offices</p>
<ul>
<li><p>ABS uses X-12-ARIMA</p></li>
<li><p>US Census Bureau uses X-13-ARIMA-SEATS</p></li>
<li><p>Statistics Canada uses X-12-ARIMA</p></li>
<li><p>ONS (UK) uses X-12-ARIMA</p></li>
<li><p>EuroStat uses X-13-ARIMA-SEATS</p></li>
</ul>
<p><strong>X-11 decomposition</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>x11_dcmp <span class="ot">&lt;-</span> us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">x11 =</span> <span class="fu">X_13ARIMA_SEATS</span>(Employed <span class="sc">~</span> <span class="fu">x11</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(x11_dcmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Advantages:</p>
<ul>
<li><p>Relatively robust to outliers</p></li>
<li><p>Completely automated choices for trend ans seasonal changes</p></li>
<li><p>Very widely tested on economic data over a long period of time</p></li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><p>No prediction/confidence intervals</p></li>
<li><p>Ad hoc method with no underlying model</p></li>
<li><p>Only developed for quarterly and monthly data</p></li>
</ul>
<p>Extensions: X-12-ARIMA and X-13-ARIMA</p>
<ul>
<li><p>The X-11, X-12-ARIMA and X-13-ARIMA methods are based on Census II decomposition</p></li>
<li><p>These allow adjustments for trading days and other explanatory variables</p></li>
<li><p>Known outliers can be omitted</p></li>
<li><p>Level shifts and ramp effects can be modelled</p></li>
<li><p>Missing values estimated and replaced</p></li>
<li><p>Holiday factors (e.g.&nbsp;Easter, Labour Day) can be estimated</p></li>
</ul>
<p><strong>X-13-ARIMA-SEATS<br>
</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>seats_dcmp <span class="ot">&lt;-</span> us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">seats =</span> <span class="fu">X_13ARIMA_SEATS</span>(Employed <span class="sc">~</span> <span class="fu">seats</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(seats_dcmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-112-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Advantages:</p>
<ul>
<li><p>Model-based</p></li>
<li><p>Smooth trend estimate</p></li>
<li><p>Allows estimated at end points</p></li>
<li><p>Allows changing seasonality</p></li>
<li><p>Developed for economic data</p></li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Only developed for quarterly and monthly data</li>
</ul>
</section>
<section id="stl-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="stl-decomposition">3.6 STL decomposition</h2>
<ul>
<li><p>STL: “Seasonal and Trend decomposition using Loess”</p></li>
<li><p>Very versatile and robust</p></li>
<li><p>Unlike X-12-ARIMA, STL will handle any type of seasonality</p></li>
<li><p>Seasonal component allowed to change over time, and rate of change controlled by user</p></li>
<li><p>Smoothness of trend-cycle also controlled by user</p></li>
<li><p>Robust to outliers</p></li>
<li><p>Not trading day or calendar adjustments</p></li>
<li><p>Only additive</p></li>
<li><p>Take logs to get multiplicative decomposition</p></li>
<li><p>Use Box-Cox transformations to get other decompositions</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed)) <span class="sc">|&gt;</span> </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="st">"periodic"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">49</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">19</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-116-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">5</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-117-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">5</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-118-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">6665</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-119-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">15</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">15</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">15</span>),</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">robust =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"STL decomposition: US retail employment"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">season</span>(<span class="at">window =</span> <span class="dv">5</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 357 x 7 [1M]
# Key:     .model [1]
# :        Employed = trend + season_year + remainder
   .model              Month Employed  trend season_year remainder season_adjust
   &lt;chr&gt;               &lt;mth&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 STL(Employed … 1990 janv.   13256. 13294.       -2.16    -36.2         13258.
 2 STL(Employed … 1990 févr.   12966. 13273.     -260.      -47.3         13226.
 3 STL(Employed …  1990 mars   12938. 13252.     -289.      -25.1         13227.
 4 STL(Employed …  1990 avr.   13012. 13231.     -221.        2.25        13233.
 5 STL(Employed …   1990 mai   13108. 13209.     -111.        9.96        13219.
 6 STL(Employed …  1990 juin   13183. 13188.      -18.8      14.1         13202.
 7 STL(Employed … 1990 juil.   13170. 13166.      -17.9      22.1         13188.
 8 STL(Employed …  1990 août   13160. 13144.       -2.53     18.1         13162.
 9 STL(Employed … 1990 sept.   13113. 13122.      -34.0      25.3         13147.
10 STL(Employed …  1990 oct.   13185. 13100.       54.3      30.7         13131.
# ℹ 347 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    Employed <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">season</span>(<span class="at">window =</span> <span class="st">"periodic"</span>),</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">robust =</span> <span class="cn">TRUE</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 357 x 7 [1M]
# Key:     .model [1]
# :        Employed = trend + season_year + remainder
   .model              Month Employed  trend season_year remainder season_adjust
   &lt;chr&gt;               &lt;mth&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 "STL(Employed… 1990 janv.   13256. 13247.      -80.8      89.9         13337.
 2 "STL(Employed… 1990 févr.   12966. 13235.     -273.        4.72        13240.
 3 "STL(Employed…  1990 mars   12938. 13223.     -258.      -26.5         13197.
 4 "STL(Employed…  1990 avr.   13012. 13211.     -186.      -12.6         13198.
 5 "STL(Employed…   1990 mai   13108. 13198.      -88.4      -1.74        13197.
 6 "STL(Employed…  1990 juin   13183. 13186.       -8.47      5.67        13191.
 7 "STL(Employed… 1990 juil.   13170. 13173.      -10.9       8.17        13181.
 8 "STL(Employed…  1990 août   13160. 13157.      -11.5      13.5         13171.
 9 "STL(Employed… 1990 sept.   13113. 13142.      -88.0      59.2         13201.
10 "STL(Employed…  1990 oct.   13185. 13116.       39.0      29.8         13146.
# ℹ 347 more rows</code></pre>
</div>
</div>
<ul>
<li><p><code>trend(window = ?)</code> controls wiggliness of trend component</p></li>
<li><p><code>season(window = ?)</code> controls variation on seasonal component</p></li>
<li><p><code>season(window = 'periodic')</code> is equivalent to an infinite window</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed)) <span class="sc">|&gt;</span> </span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-123-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><code>STL()</code> chooses <code>season(window=13)</code> by default</p></li>
<li><p>Can include transformations</p></li>
</ul>
<p><strong>STL decomposition</strong></p>
<ul>
<li><p>Algorithm that updates trend and seasonal components iteratively</p></li>
<li><p>Starts with <span class="math inline">\(\hat{T_t}=0\)</span></p></li>
<li><p>Uses a mixture of loess and moving averages to successively refine the trend and seasonal estimates</p></li>
<li><p>The trend window controls loess bandwidth applied to deseasonalised values</p></li>
<li><p>The season window controls loess bandwidth applied to detrended subseries</p></li>
<li><p>Robustness weights based on remainder</p></li>
<li><p>Default season: <code>window=13</code></p></li>
<li><p>Default trend: <code>window=nextodd(ceiling((1.5*period)/(1-(1.5/s.window)))</code></p></li>
</ul>
</section>
</section>
<section id="chapter-4---time-series-features" class="level1">
<h1>Chapter 4 - Time series features</h1>
<section id="some-simple-statistics" class="level2">
<h2 class="anchored" data-anchor-id="some-simple-statistics">4.1 Some simple statistics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span> </span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, <span class="fu">list</span>(<span class="at">mean =</span> mean)) <span class="sc">|&gt;</span> </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 4
   Region          State              Purpose   mean
   &lt;chr&gt;           &lt;chr&gt;              &lt;chr&gt;    &lt;dbl&gt;
 1 Kangaroo Island South Australia    Other    0.340
 2 MacDonnell      Northern Territory Other    0.449
 3 Wilderness West Tasmania           Other    0.478
 4 Barkly          Northern Territory Other    0.632
 5 Clare Valley    South Australia    Other    0.898
 6 Barossa         South Australia    Other    1.02 
 7 Kakadu Arnhem   Northern Territory Other    1.04 
 8 Lasseter        Northern Territory Other    1.14 
 9 Wimmera         Victoria           Other    1.15 
10 MacDonnell      Northern Territory Visiting 1.18 
# ℹ 294 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span> </span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, quantile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 8
   Region         State             Purpose    `0%`  `25%`   `50%`  `75%` `100%`
   &lt;chr&gt;          &lt;chr&gt;             &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Adelaide       South Australia   Busine…  68.7   134.   153.    177.   242.  
 2 Adelaide       South Australia   Holiday 108.    135.   154.    172.   224.  
 3 Adelaide       South Australia   Other    25.9    43.9   53.8    62.5  107.  
 4 Adelaide       South Australia   Visiti… 137.    179.   206.    229.   270.  
 5 Adelaide Hills South Australia   Busine…   0       0      1.26    3.92  28.6 
 6 Adelaide Hills South Australia   Holiday   0       5.77   8.52   14.1   35.8 
 7 Adelaide Hills South Australia   Other     0       0      0.908   2.09   8.95
 8 Adelaide Hills South Australia   Visiti…   0.778   8.91  12.2    16.8   81.1 
 9 Alice Springs  Northern Territo… Busine…   1.01    9.13  13.3    18.5   34.1 
10 Alice Springs  Northern Territo… Holiday   2.81   16.9   31.5    44.8   76.5 
# ℹ 294 more rows</code></pre>
</div>
</div>
</section>
<section id="acf-features" class="level2">
<h2 class="anchored" data-anchor-id="acf-features">4.2 ACF features</h2>
<ul>
<li><p>The sum of the first ten squared autocorrelation coefficients is a useful summary of how much autocorrelation there is in a series, regardless of lag.</p></li>
<li><p>We can also compute autocorrelations of the changes in the series between periods: we “difference” the data and create a new time series consisting of the differences between consecutive observations. Then we can compute the autocorrelations of this new differenced series.</p></li>
</ul>
<p>The <code>feat_acf()</code> function computes a selection of autocorrelations:</p>
<ul>
<li><p>the first autocorrelation coefficient from the original data</p></li>
<li><p>the sum of squares of the first ten autocorrelation coefficients from the original data</p></li>
<li><p>the first autocorrelation coefficient from the differenced data</p></li>
<li><p>the sum of squares of the first ten autocorrelation coefficients from the differenced data</p></li>
<li><p>the first autocorrelation coefficient from the twice differenced data</p></li>
<li><p>the sum of squares of the first ten autocorrelation coefficients from the twice differenced data</p></li>
<li><p>for seasonal data, the autocorrelation coefficient at the first seasonal lag is also returned</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span> <span class="fu">features</span>(Trips, feat_acf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 10
   Region         State Purpose     acf1 acf10 diff1_acf1 diff1_acf10 diff2_acf1
   &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
 1 Adelaide       Sout… Busine…  0.0333  0.131     -0.520       0.463     -0.676
 2 Adelaide       Sout… Holiday  0.0456  0.372     -0.343       0.614     -0.487
 3 Adelaide       Sout… Other    0.517   1.15      -0.409       0.383     -0.675
 4 Adelaide       Sout… Visiti…  0.0684  0.294     -0.394       0.452     -0.518
 5 Adelaide Hills Sout… Busine…  0.0709  0.134     -0.580       0.415     -0.750
 6 Adelaide Hills Sout… Holiday  0.131   0.313     -0.536       0.500     -0.716
 7 Adelaide Hills Sout… Other    0.261   0.330     -0.253       0.317     -0.457
 8 Adelaide Hills Sout… Visiti…  0.139   0.117     -0.472       0.239     -0.626
 9 Alice Springs  Nort… Busine…  0.217   0.367     -0.500       0.381     -0.658
10 Alice Springs  Nort… Holiday -0.00660 2.11      -0.153       2.11      -0.274
# ℹ 294 more rows
# ℹ 2 more variables: diff2_acf10 &lt;dbl&gt;, season_acf1 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="stl-features" class="level2">
<h2 class="anchored" data-anchor-id="stl-features">4.3 STL features</h2>
<p>The decomposition is written as</p>
<p><span class="math display">\[
y_t=T_t+S_t+R_t
\]</span></p>
<p>For strongly trended data, the seasonally adjusted data should have much more variation than the remainder component. Therefore, <span class="math inline">\(Var(R_t)/(Var(T_t+S_t)\)</span> should be relatively small.</p>
<p>But for data with little or no trend, the two variances should be approximately the same. So we define the strength of trend as:</p>
<p><span class="math display">\[
F_T=max(0,1-\frac{Var(R_t)}{Var(T_t+S_t})
\]</span></p>
<p>The strength of seasonality is defined similarly, but with respect to the detrended data rather than the seasonally adjusted data:</p>
<p><span class="math display">\[
F_S=max(0,1-\frac{Var(R_t)}{Var(S_t+R_t}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span> </span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, feat_stl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 12
   Region State Purpose trend_strength seasonal_strength_year seasonal_peak_year
   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;                  &lt;dbl&gt;              &lt;dbl&gt;
 1 Adela… Sout… Busine…          0.464                  0.407                  3
 2 Adela… Sout… Holiday          0.554                  0.619                  1
 3 Adela… Sout… Other            0.746                  0.202                  2
 4 Adela… Sout… Visiti…          0.435                  0.452                  1
 5 Adela… Sout… Busine…          0.464                  0.179                  3
 6 Adela… Sout… Holiday          0.528                  0.296                  2
 7 Adela… Sout… Other            0.593                  0.404                  2
 8 Adela… Sout… Visiti…          0.488                  0.254                  0
 9 Alice… Nort… Busine…          0.534                  0.251                  0
10 Alice… Nort… Holiday          0.381                  0.832                  3
# ℹ 294 more rows
# ℹ 6 more variables: seasonal_trough_year &lt;dbl&gt;, spikiness &lt;dbl&gt;,
#   linearity &lt;dbl&gt;, curvature &lt;dbl&gt;, stl_e_acf1 &lt;dbl&gt;, stl_e_acf10 &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, feat_stl) <span class="sc">|&gt;</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> trend_strength, <span class="at">y =</span> seasonal_strength_year,</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> Purpose)) <span class="sc">+</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(State))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-128-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>tourism <span class="sc">|&gt;</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, feat_stl) <span class="sc">|&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>    seasonal_strength_year <span class="sc">==</span> <span class="fu">max</span>(seasonal_strength_year)</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tourism, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"Region"</span>, <span class="st">"Purpose"</span>), <span class="at">multiple =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter, <span class="at">y =</span> Trips)) <span class="sc">+</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(State, Region, Purpose))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-129-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="other-features" class="level2">
<h2 class="anchored" data-anchor-id="other-features">4.4 Other features</h2>
<p>In the <code>feasts</code> package: <code>coef_hurst</code>, <code>feat_spectral</code>, <code>box_pierce</code>, …</p>
</section>
<section id="exploring-australian-tourism-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-australian-tourism-data">4.5 Exploring Australian tourism data</h2>
<p>All of the features included in the <code>feasts</code> package can be computed in one line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>tourism_features <span class="ot">&lt;-</span> tourism <span class="sc">|&gt;</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(Trips, <span class="fu">feature_set</span>(<span class="at">pkgs =</span> <span class="st">"feasts"</span>))</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>tourism_features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 304 × 51
   Region State Purpose trend_strength seasonal_strength_year seasonal_peak_year
   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;                  &lt;dbl&gt;              &lt;dbl&gt;
 1 Adela… Sout… Busine…          0.464                  0.407                  3
 2 Adela… Sout… Holiday          0.554                  0.619                  1
 3 Adela… Sout… Other            0.746                  0.202                  2
 4 Adela… Sout… Visiti…          0.435                  0.452                  1
 5 Adela… Sout… Busine…          0.464                  0.179                  3
 6 Adela… Sout… Holiday          0.528                  0.296                  2
 7 Adela… Sout… Other            0.593                  0.404                  2
 8 Adela… Sout… Visiti…          0.488                  0.254                  0
 9 Alice… Nort… Busine…          0.534                  0.251                  0
10 Alice… Nort… Holiday          0.381                  0.832                  3
# ℹ 294 more rows
# ℹ 45 more variables: seasonal_trough_year &lt;dbl&gt;, spikiness &lt;dbl&gt;,
#   linearity &lt;dbl&gt;, curvature &lt;dbl&gt;, stl_e_acf1 &lt;dbl&gt;, stl_e_acf10 &lt;dbl&gt;,
#   acf1 &lt;dbl&gt;, acf10 &lt;dbl&gt;, diff1_acf1 &lt;dbl&gt;, diff1_acf10 &lt;dbl&gt;,
#   diff2_acf1 &lt;dbl&gt;, diff2_acf10 &lt;dbl&gt;, season_acf1 &lt;dbl&gt;, pacf5 &lt;dbl&gt;,
#   diff1_pacf5 &lt;dbl&gt;, diff2_pacf5 &lt;dbl&gt;, season_pacf &lt;dbl&gt;,
#   zero_run_mean &lt;dbl&gt;, nonzero_squared_cv &lt;dbl&gt;, zero_start_prop &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>This gives 48 features for every combination of the three key variables (<code>Region</code>, <code>State</code> and <code>Purpose</code>).</p>
<p>We can do pairwise plots of groups of features:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>tourism_features <span class="sc">|&gt;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(<span class="fu">contains</span>(<span class="st">"season"</span>), Purpose)) <span class="sc">|&gt;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_peak_year =</span> seasonal_peak_year <span class="sc">+</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span><span class="sc">*</span>(seasonal_peak_year<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_trough_year =</span> seasonal_trough_year <span class="sc">+</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span><span class="sc">*</span>(seasonal_trough_year<span class="sc">==</span><span class="dv">0</span>),</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_peak_year =</span> <span class="fu">glue</span>(<span class="st">"Q{seasonal_peak_year}"</span>),</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seasonal_trough_year =</span> <span class="fu">glue</span>(<span class="st">"Q{seasonal_trough_year}"</span>),</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  GGally<span class="sc">::</span><span class="fu">ggpairs</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">colour =</span> Purpose))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-131-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can compute the principal components of the tourism features:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>pcs <span class="ot">&lt;-</span> tourism_features <span class="sc">|&gt;</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>State, <span class="sc">-</span>Region, <span class="sc">-</span>Purpose) <span class="sc">|&gt;</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prcomp</span>(<span class="at">scale =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(tourism_features)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>pcs <span class="sc">|&gt;</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fittedPC1, <span class="at">y =</span> .fittedPC2, <span class="at">col =</span> Purpose)) <span class="sc">+</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-132-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> pcs <span class="sc">|&gt;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.fittedPC1 <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Region, State, Purpose, .fittedPC1, .fittedPC2)</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>outliers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  Region                 State             Purpose  .fittedPC1 .fittedPC2
  &lt;chr&gt;                  &lt;chr&gt;             &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;
1 Australia's North West Western Australia Business       13.4    -11.3  
2 Australia's South West Western Australia Holiday        10.9      0.880
3 Melbourne              Victoria          Holiday        12.3    -10.4  
4 South Coast            New South Wales   Holiday        11.9      9.42 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Region                 State             Purpose  .fittedPC1 .fittedPC2</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                  &lt;chr&gt;             &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Australia's North West Western Australia Business       13.4    -11.3  </span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Australia's South West Western Australia Holiday        10.9      0.880</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Melbourne              Victoria          Holiday        12.3    -10.4  </span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 South Coast            New South Wales   Holiday        11.9      9.42</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>outliers <span class="sc">|&gt;</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tourism, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"Region"</span>, <span class="st">"Purpose"</span>), <span class="at">multiple =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Series =</span> <span class="fu">glue</span>(<span class="st">"{State}"</span>, <span class="st">"{Region}"</span>, <span class="st">"{Purpose}"</span>, <span class="at">.sep =</span> <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter, <span class="at">y =</span> Trips)) <span class="sc">+</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Series <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Outlying time series in PC space"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-133-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="chapter-5---the-forecasters-toolbox" class="level1">
<h1>Chapter 5 - The forecaster’s toolbox</h1>
<section id="a-tidy-forecasting-workflow" class="level2">
<h2 class="anchored" data-anchor-id="a-tidy-forecasting-workflow">5.1 A tidy forecasting workflow</h2>
<p>The process of producing forecasts can be split up into a few fundamental steps:</p>
<ol type="1">
<li>Preparing data - generate a <code>tsibble</code></li>
<li>Data visualisation</li>
<li>Specifying a model</li>
<li>Model estimation - <code>model()</code> -&gt; <code>mable</code></li>
<li>Accuracy &amp; performance evaluation</li>
<li>Producing forecasts - <code>forecast()</code> -&gt; <code>fable</code></li>
</ol>
<p><img src="images/clipboard-1016832891.png" class="img-fluid"></p>
<p><strong>Data preparation (tidy)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>gdppc <span class="ot">&lt;-</span> global_economy <span class="sc">|&gt;</span> </span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">GDP_per_capita =</span> GDP <span class="sc">/</span> Population) <span class="sc">|&gt;</span> </span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, Country, GDP, Population, GDP_per_capita)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>gdppc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 15,150 x 5 [1Y]
# Key:       Country [263]
    Year Country             GDP Population GDP_per_capita
   &lt;dbl&gt; &lt;fct&gt;             &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
 1  1960 Afghanistan  537777811.    8996351           59.8
 2  1961 Afghanistan  548888896.    9166764           59.9
 3  1962 Afghanistan  546666678.    9345868           58.5
 4  1963 Afghanistan  751111191.    9533954           78.8
 5  1964 Afghanistan  800000044.    9731361           82.2
 6  1965 Afghanistan 1006666638.    9938414          101. 
 7  1966 Afghanistan 1399999967.   10152331          138. 
 8  1967 Afghanistan 1673333418.   10372630          161. 
 9  1968 Afghanistan 1373333367.   10604346          130. 
10  1969 Afghanistan 1408888922.   10854428          130. 
# ℹ 15,140 more rows</code></pre>
</div>
</div>
<p><strong>Visualise</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>gdppc <span class="sc">|&gt;</span> </span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Sweden"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(GDP_per_capita) <span class="sc">+</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"GDP per capita for Sweden"</span>,</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$US"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-135-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Specify a model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> gdppc <span class="sc">|&gt;</span> </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">trend_model =</span> <span class="fu">TSLM</span>(GDP_per_capita <span class="sc">~</span> <span class="fu">trend</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 7 errors (1 unique) encountered for trend_model
[7] aucun cas ne contient autre chose que des valeurs manquantes (NA)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 263 x 2
# Key:     Country [263]
   Country             trend_model
   &lt;fct&gt;                   &lt;model&gt;
 1 Afghanistan              &lt;TSLM&gt;
 2 Albania                  &lt;TSLM&gt;
 3 Algeria                  &lt;TSLM&gt;
 4 American Samoa           &lt;TSLM&gt;
 5 Andorra                  &lt;TSLM&gt;
 6 Angola                   &lt;TSLM&gt;
 7 Antigua and Barbuda      &lt;TSLM&gt;
 8 Arab World               &lt;TSLM&gt;
 9 Argentina                &lt;TSLM&gt;
10 Armenia                  &lt;TSLM&gt;
# ℹ 253 more rows</code></pre>
</div>
</div>
<p>A <code>mable</code> is a model table, each cell corresponds to a fitted model.</p>
<p><strong>Evaluate the model</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"3 years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 789 x 5 [1Y]
# Key:     Country, .model [263]
   Country        .model       Year
   &lt;fct&gt;          &lt;chr&gt;       &lt;dbl&gt;
 1 Afghanistan    trend_model  2018
 2 Afghanistan    trend_model  2019
 3 Afghanistan    trend_model  2020
 4 Albania        trend_model  2018
 5 Albania        trend_model  2019
 6 Albania        trend_model  2020
 7 Algeria        trend_model  2018
 8 Algeria        trend_model  2019
 9 Algeria        trend_model  2020
10 American Samoa trend_model  2018
# ℹ 779 more rows
# ℹ 2 more variables: GDP_per_capita &lt;dist&gt;, .mean &lt;dbl&gt;</code></pre>
</div>
</div>
<p>A <code>fable</code> is a forecast table with point forecasts and distributions.</p>
<p><strong>Visualising forecasts</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>fit <span class="sc">|&gt;</span> </span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"3 years"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Sweden"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(gdppc) <span class="sc">+</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"GDP per capita for Sweden"</span>,</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$US"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-138-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="some-simple-forecasting-methods" class="level2">
<h2 class="anchored" data-anchor-id="some-simple-forecasting-methods">5.2 Some simple forecasting methods</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"1970 Q1"</span> <span class="sc">~</span> <span class="st">"2004 Q1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Bricks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Mean method</strong></p>
<ul>
<li><p>Forecast of all future values is equal to mean of historical data <span class="math inline">\(\{y_t,...,y_T\}\)</span></p></li>
<li><p>Forecasts: <span class="math inline">\(\hat{y}_{T+h|T}=\bar{y}=(y_1+...+y_T)/T\)</span></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span> </span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">MEAN</span>(Bricks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  `MEAN(Bricks)`
         &lt;model&gt;
1         &lt;MEAN&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">average =</span> <span class="fu">mean</span>(Bricks))</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>fc <span class="ot">&lt;-</span> bricks <span class="sc">|&gt;</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">Quarter =</span> <span class="fu">list</span>(<span class="fu">as.Date</span>(Quarter) <span class="sc">+</span> <span class="fu">months</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span> <span class="sc">*</span> <span class="dv">5</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `unnest()` has a new interface. See `?unnest` for details.
ℹ Try `df %&gt;% unnest(c(Quarter))`, with `mutate()` if needed.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quarter, <span class="at">y =</span> Bricks)) <span class="sc">+</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> average), <span class="at">colour =</span> <span class="st">"#0072B2"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> average), <span class="at">data =</span> fc, <span class="at">colour =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clay brick production in Australia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-141-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Naïve method</strong></p>
<ul>
<li><p>Forecasts equal to last observed value</p></li>
<li><p>Forecasts: <span class="math inline">\(\hat{y}_{T+h|T}=y_T\)</span></p></li>
<li><p>Consequence of efficient market hypothesis</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span> <span class="fu">model</span>(<span class="fu">NAIVE</span>(Bricks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  `NAIVE(Bricks)`
          &lt;model&gt;
1         &lt;NAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">NAIVE</span>(Bricks)) <span class="sc">|&gt;</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">|&gt;</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">filter</span>(bricks, <span class="fu">year</span>(Quarter) <span class="sc">&gt;</span> <span class="dv">1990</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">slice</span>(bricks, <span class="fu">n</span>()), <span class="fu">aes</span>(<span class="at">y =</span> Bricks), <span class="at">colour =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clay brick production in Australia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-143-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Seasonal naïve method</strong></p>
<ul>
<li><p>Forecasts equal to last value from same season</p></li>
<li><p>Forecasts: <span class="math inline">\(\hat{y}_{T+h|T}=y_{T+h-m(k+1)}\)</span> where <span class="math inline">\(m\)</span> = seasonal period and <span class="math inline">\(k\)</span> is the integer part of <span class="math inline">\((h-1)/m\)</span></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span> <span class="fu">model</span>(<span class="fu">SNAIVE</span>(Bricks <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  `SNAIVE(Bricks ~ lag("year"))`
                         &lt;model&gt;
1                       &lt;SNAIVE&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">SNAIVE</span>(Bricks <span class="sc">~</span> <span class="fu">lag</span>(<span class="st">"year"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">|&gt;</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">filter</span>(bricks, <span class="fu">year</span>(Quarter) <span class="sc">&gt;</span> <span class="dv">1990</span>), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">slice</span>(bricks, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">3</span>)<span class="sc">:</span><span class="fu">n</span>()), <span class="fu">aes</span>(<span class="at">y =</span> Bricks), <span class="at">colour =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clay brick production in Australia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-145-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>RW: drift method</strong></p>
<p>RW: Random Walk</p>
<ul>
<li><p>Forecasts equal to last value plus average change</p></li>
<li><p>Forecasts:</p></li>
</ul>
<p><span class="math display">\[
\hat{y}_{T+h|T}=y_T+\frac{h}{T-1}\sum_{t=2}^T(y_t-y_{t-1})=y_T+\frac{h}{T-1}(y_T-y_1)
\]</span></p>
<ul>
<li>Equivalent to extrapolating a line drawn between first and last observations</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>bricks <span class="sc">|&gt;</span> <span class="fu">model</span>(<span class="fu">RW</span>(Bricks <span class="sc">~</span> <span class="fu">drift</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  `RW(Bricks ~ drift())`
                 &lt;model&gt;
1          &lt;RW w/ drift&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">RW</span>(Bricks <span class="sc">~</span> <span class="fu">drift</span>())) <span class="sc">|&gt;</span></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">|&gt;</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(aus_production, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">slice</span>(aus_production, <span class="fu">range</span>(<span class="fu">cumsum</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)))),</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> Bricks), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"#0072B2"</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clay brick production in Australia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 20 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-147-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Model fitting</strong></p>
<p>The <code>model()</code> function trains models to data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>brick_fit <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span> </span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Seasonal_naive =</span> <span class="fu">SNAIVE</span>(Bricks),</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Naive =</span> <span class="fu">NAIVE</span>(Bricks),</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Drift =</span> <span class="fu">RW</span>(Bricks <span class="sc">~</span> <span class="fu">drift</span>()),</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">MEAN</span>(Bricks)</span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>brick_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 4
  Seasonal_naive   Naive         Drift    Mean
         &lt;model&gt; &lt;model&gt;       &lt;model&gt; &lt;model&gt;
1       &lt;SNAIVE&gt; &lt;NAIVE&gt; &lt;RW w/ drift&gt;  &lt;MEAN&gt;</code></pre>
</div>
</div>
<p><strong>Producing forecasts</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>brick_fc <span class="ot">&lt;-</span> brick_fit <span class="sc">|&gt;</span> </span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>brick_fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 80 x 4 [1Q]
# Key:     .model [4]
   .model         Quarter
   &lt;chr&gt;            &lt;qtr&gt;
 1 Seasonal_naive 2005 Q3
 2 Seasonal_naive 2005 Q4
 3 Seasonal_naive 2006 Q1
 4 Seasonal_naive 2006 Q2
 5 Seasonal_naive 2006 Q3
 6 Seasonal_naive 2006 Q4
 7 Seasonal_naive 2007 Q1
 8 Seasonal_naive 2007 Q2
 9 Seasonal_naive 2007 Q3
10 Seasonal_naive 2007 Q4
# ℹ 70 more rows
# ℹ 2 more variables: Bricks &lt;dist&gt;, .mean &lt;dbl&gt;</code></pre>
</div>
</div>
<p><strong>Visualising forecasts</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>brick_fc <span class="sc">|&gt;</span> </span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(aus_production, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clay brick production in Australia"</span>,</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Millions of bricks"</span>) <span class="sc">+</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 20 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-152-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Facebook closing stock price</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract training data</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>fb_stock <span class="ot">&lt;-</span> gafa_stock <span class="sc">|&gt;</span> </span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"FB"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trading_day =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_tsibble</span>(<span class="at">index =</span> trading_day, <span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify, estimate and forecast</span></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>fb_stock <span class="sc">|&gt;</span> </span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">MEAN</span>(Close),</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Naive =</span> <span class="fu">NAIVE</span>(Close),</span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Drift =</span> <span class="fu">RW</span>(Close <span class="sc">~</span> <span class="fu">drift</span>())</span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">42</span>) <span class="sc">|&gt;</span> </span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(fb_stock, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Facebook closing stock price"</span>,</span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$US"</span>) <span class="sc">+</span></span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-153-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Australian quarterly beer production</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set training data from 1992 to 2006</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_index</span>(<span class="st">"1992 Q1"</span> <span class="sc">~</span> <span class="st">"2006 Q4"</span>)</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the models</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>beer_fit <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">MEAN</span>(Beer),</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">NAIVE</span>(Beer),</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Seasonal naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">SNAIVE</span>(Beer)</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate forecasts for 14 quarters</span></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="ot">&lt;-</span> beer_fit <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">14</span>)</span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot forecasts against actual values</span></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="sc">|&gt;</span></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(train, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(</span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter_index</span>(aus_production, <span class="st">"2007 Q1"</span> <span class="sc">~</span> .),</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"black"</span></span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Megalitres"</span>,</span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Forecasts for quarterly beer production"</span></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = Beer`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-154-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fitted-values-and-residuals" class="level2">
<h2 class="anchored" data-anchor-id="fitted-values-and-residuals">5.3 Fitted values and residuals</h2>
<ul>
<li><p><span class="math inline">\(\hat{y}_{t|t-1}\)</span> is the forecast of <span class="math inline">\(y_t\)</span> based on observations <span class="math inline">\(y_1,...,y_{t-1}\)</span></p></li>
<li><p>we call these “fitted values”</p></li>
<li><p>sometimes drop the subscript: <span class="math inline">\(\hat{y_t} \equiv \hat{y}_{t|t-1}\)</span></p></li>
<li><p>often not true forecasts since parameters are estimated on all data</p></li>
</ul>
<p>For example:</p>
<ul>
<li><p><span class="math inline">\(\hat{y}_t=\bar{t}\)</span> for average method</p></li>
<li><p><span class="math inline">\(\hat{y}=y_{t-1}+(y_T-y_1)/(T-1)\)</span> for drift method</p></li>
</ul>
<p><strong>Residuals in forecasting</strong>: difference between observed value and its fitted value <span class="math inline">\(e_t=y_t-\hat{y}_{t|t-1}\)</span>.</p>
<p>Assumptions:</p>
<ul>
<li><p><span class="math inline">\(\{e_t\}\)</span> uncorrelated. If they aren’t, then information left in residuals that should be used in computing forecasts.</p></li>
<li><p><span class="math inline">\(\{e_t\}\)</span> have mean zero. If they don’t, then forecasts are biased.</p></li>
</ul>
<p>Useful properties (for distributions &amp; prediction intervals</p>
<ul>
<li><p><span class="math inline">\(\{e_t\}\)</span> have constant variance.</p></li>
<li><p><span class="math inline">\(\{e_t\}\)</span> are normally distributed.</p></li>
</ul>
<p>To compute the fitted values and residuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(beer_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 180 x 6 [1Q]
# Key:       .model [3]
   .model Quarter  Beer .fitted .resid .innov
   &lt;chr&gt;    &lt;qtr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Mean   1992 Q1   443    436.   6.55   6.55
 2 Mean   1992 Q2   410    436. -26.4  -26.4 
 3 Mean   1992 Q3   420    436. -16.4  -16.4 
 4 Mean   1992 Q4   532    436.  95.6   95.6 
 5 Mean   1993 Q1   433    436.  -3.45  -3.45
 6 Mean   1993 Q2   421    436. -15.4  -15.4 
 7 Mean   1993 Q3   410    436. -26.4  -26.4 
 8 Mean   1993 Q4   512    436.  75.6   75.6 
 9 Mean   1994 Q1   449    436.  12.6   12.6 
10 Mean   1994 Q2   381    436. -55.4  -55.4 
# ℹ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="residual-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="residual-diagnostics">5.4 Residual diagnostics</h2>
<p>Facebook closing stock price</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>fb_stock <span class="sc">|&gt;</span> </span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(Close)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-156-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> fb_stock <span class="sc">|&gt;</span> </span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">NAIVE</span>(Close))</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1,258 x 7 [1]
# Key:       Symbol, .model [1]
   Symbol .model       trading_day Close .fitted .resid .innov
   &lt;chr&gt;  &lt;chr&gt;              &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 FB     NAIVE(Close)           1  54.7    NA   NA     NA    
 2 FB     NAIVE(Close)           2  54.6    54.7 -0.150 -0.150
 3 FB     NAIVE(Close)           3  57.2    54.6  2.64   2.64 
 4 FB     NAIVE(Close)           4  57.9    57.2  0.720  0.720
 5 FB     NAIVE(Close)           5  58.2    57.9  0.310  0.310
 6 FB     NAIVE(Close)           6  57.2    58.2 -1.01  -1.01 
 7 FB     NAIVE(Close)           7  57.9    57.2  0.720  0.720
 8 FB     NAIVE(Close)           8  55.9    57.9 -2.03  -2.03 
 9 FB     NAIVE(Close)           9  57.7    55.9  1.83   1.83 
10 FB     NAIVE(Close)          10  57.6    57.7 -0.140 -0.140
# ℹ 1,248 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> trading_day)) <span class="sc">+</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Close, <span class="at">colour =</span> <span class="st">"Data"</span>)) <span class="sc">+</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> <span class="st">"Fitted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-158-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trading_day <span class="sc">&gt;</span> <span class="dv">1100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> trading_day)) <span class="sc">+</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Close, <span class="at">colour =</span> <span class="st">"Data"</span>)) <span class="sc">+</span></span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">colour =</span> <span class="st">"Fitted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-159-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(.resid) <span class="sc">+</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"$US"</span>,</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Residuals from naïve method"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-160-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .resid)) <span class="sc">+</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">150</span>) <span class="sc">+</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(.resid) <span class="sc">|&gt;</span> </span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ACF of residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-162-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_tsresiduals</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-163-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ACF of residuals</p>
<ul>
<li><p>We assume that the residuals are white noise (uncorrelated, mean zero, constant variance). If they aren’t, then there is information left in the residuals that should be used in computing forecasts.</p></li>
<li><p>So a standard residual diagnostic is to check the ACF of the residuals of a forecasting method.</p></li>
<li><p>We <em>expect</em> these to look like white noise.</p></li>
</ul>
<p><strong>Portmanteau tests</strong></p>
<p><span class="math inline">\(r_k\)</span>=autocorrelation of residual at lag <span class="math inline">\(k\)</span></p>
<p>Consider a whole set of <span class="math inline">\(r_k\)</span> values, and develop a test to see whether the set is significantly different from a zero test.</p>
<p>Box-Pierce test :</p>
<p><span class="math display">\[
Q=T\sum_{k=1}^lr_k^2
\]</span></p>
<p>where <span class="math inline">\(l\)</span> is max lag being considered and <span class="math inline">\(T\)</span> is number of observations.</p>
<ul>
<li><p>if each <span class="math inline">\(r_k\)</span> close to 0, <span class="math inline">\(Q\)</span> will be small</p></li>
<li><p>if some <span class="math inline">\(r_k\)</span> values large (positive or negative), <span class="math inline">\(Q\)</span> will be large</p></li>
</ul>
<p>Ljung-Box test :</p>
<p><span class="math display">\[
Q^*=T(T+2)\sum_{k=1}^l(T-k)^{-1}r_k^2
\]</span></p>
<p>where <span class="math inline">\(k\)</span> is max lag being considered and <span class="math inline">\(T\)</span> is number of observations.</p>
<ul>
<li><p>my preferences: <span class="math inline">\(l\)</span>=10 for non-seasonal data, <span class="math inline">\(l\)</span>=2m for seasonal data (where <span class="math inline">\(m\)</span> is seasonal period)</p></li>
<li><p>better performance, especially in small samples</p></li>
<li><p>if data were white noise, <span class="math inline">\(Q^*\)</span> has a <span class="math inline">\(\chi^2\)</span> distribution with <span class="math inline">\(l\)</span> degrees of freedom</p></li>
<li><p>lag = <span class="math inline">\(l\)</span></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(fit) <span class="sc">|&gt;</span> </span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(.resid, ljung_box, <span class="at">lag =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  Symbol .model       lb_stat lb_pvalue
  &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 FB     NAIVE(Close)    12.1     0.276</code></pre>
</div>
</div>
<p>If pval &lt; 0.05, we reject the white noise hypothesis.</p>
<p>In our case, we accept the hypothesis that the residuals are not easily distinguished from white noise.</p>
</section>
<section id="distributional-forecasts-and-prediction-intervals" class="level2">
<h2 class="anchored" data-anchor-id="distributional-forecasts-and-prediction-intervals">5.5 Distributional forecasts and prediction intervals</h2>
<ul>
<li><p>A forecast <span class="math inline">\(\hat{y}_{T+h|T}\)</span> is (usually) the mean of the conditional distribution <span class="math inline">\(y_{T+h}|y_1,...,y_T\)</span>.</p></li>
<li><p>Most time series models produce normally distributed forecasts.</p></li>
<li><p>The forecast distribution describes the probability of observing any future value.</p></li>
</ul>
<p>Assuming residuals are normal, uncorrelated, <span class="math inline">\(sd=\hat{\sigma}\)</span>:</p>
<p><strong>Mean</strong>: <span class="math inline">\(y_{T+h|T} \sim N(\hat{y},(1+1/T)\hat{\sigma}^2)\)</span></p>
<p><strong>Naïve</strong>: <span class="math inline">\(y_{T+h|T} \sim N(y_T,h\hat{\sigma}^2)\)</span></p>
<p><strong>Seasonal naîve</strong>: <span class="math inline">\(y_{T+h|T} \sim N(y_{T+h-m(k+1)},(k+1)\hat{\sigma}^2)\)</span></p>
<p><strong>Drift</strong>: <span class="math inline">\(y_{T+h|T} \sim N(y_T+\frac{h}{T-1}(y_T-y_1),h\frac{T+h}{T}\hat{\sigma}^2)\)</span></p>
<p>where <span class="math inline">\(k\)</span> is the integer part of <span class="math inline">\((h-1)/m\)</span>.</p>
<p>Note that when <span class="math inline">\(h=1\)</span> and <span class="math inline">\(T\)</span> is large, these all give the same approximate forecast variance: <span class="math inline">\(\hat{\sigma}^2\)</span>.</p>
<ul>
<li><p>A prediction interval gives a region within which we expect <span class="math inline">\(y_{T+h}\)</span> to lie with a specified probability</p></li>
<li><p>Assuming forecast errors are normally distributed, then a 95% PI is <span class="math inline">\(\hat{y}_{T+h|T} \pm 1.96\hat{\sigma}_h\)</span> where <span class="math inline">\(\hat{\sigma}_h\)</span> is the st dev of the h-step distribution</p></li>
<li><p>When h=1, <span class="math inline">\(\hat{\sigma}_h\)</span> can be estimated from the residuals</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Seasonal_naive =</span> <span class="fu">SNAIVE</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 20 x 4 [1Q]
# Key:     .model [1]
   .model         Quarter
   &lt;chr&gt;            &lt;qtr&gt;
 1 Seasonal_naive 2005 Q3
 2 Seasonal_naive 2005 Q4
 3 Seasonal_naive 2006 Q1
 4 Seasonal_naive 2006 Q2
 5 Seasonal_naive 2006 Q3
 6 Seasonal_naive 2006 Q4
 7 Seasonal_naive 2007 Q1
 8 Seasonal_naive 2007 Q2
 9 Seasonal_naive 2007 Q3
10 Seasonal_naive 2007 Q4
11 Seasonal_naive 2008 Q1
12 Seasonal_naive 2008 Q2
13 Seasonal_naive 2008 Q3
14 Seasonal_naive 2008 Q4
15 Seasonal_naive 2009 Q1
16 Seasonal_naive 2009 Q2
17 Seasonal_naive 2009 Q3
18 Seasonal_naive 2009 Q4
19 Seasonal_naive 2010 Q1
20 Seasonal_naive 2010 Q2
# ℹ 2 more variables: Bricks &lt;dist&gt;, .mean &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Seasonal_naive =</span> <span class="fu">SNAIVE</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>(<span class="at">level =</span> <span class="dv">95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 20 x 5 [1Q]
# Key:       .model [1]
   .model         Quarter
   &lt;chr&gt;            &lt;qtr&gt;
 1 Seasonal_naive 2005 Q3
 2 Seasonal_naive 2005 Q4
 3 Seasonal_naive 2006 Q1
 4 Seasonal_naive 2006 Q2
 5 Seasonal_naive 2006 Q3
 6 Seasonal_naive 2006 Q4
 7 Seasonal_naive 2007 Q1
 8 Seasonal_naive 2007 Q2
 9 Seasonal_naive 2007 Q3
10 Seasonal_naive 2007 Q4
11 Seasonal_naive 2008 Q1
12 Seasonal_naive 2008 Q2
13 Seasonal_naive 2008 Q3
14 Seasonal_naive 2008 Q4
15 Seasonal_naive 2009 Q1
16 Seasonal_naive 2009 Q2
17 Seasonal_naive 2009 Q3
18 Seasonal_naive 2009 Q4
19 Seasonal_naive 2010 Q1
20 Seasonal_naive 2010 Q2
# ℹ 3 more variables: Bricks &lt;dist&gt;, .mean &lt;dbl&gt;, `95%` &lt;hilo&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>aus_production <span class="sc">|&gt;</span> </span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">Seasonal_naive =</span> <span class="fu">SNAIVE</span>(Bricks)) <span class="sc">|&gt;</span> </span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"5 years"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hilo</span>(<span class="at">level =</span> <span class="dv">95</span>) <span class="sc">|&gt;</span> </span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower =</span> <span class="st">`</span><span class="at">95%</span><span class="st">`</span><span class="sc">$</span>lower,</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="st">`</span><span class="at">95%</span><span class="st">`</span><span class="sc">$</span>upper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 20 x 7 [1Q]
# Key:       .model [1]
   .model         Quarter
   &lt;chr&gt;            &lt;qtr&gt;
 1 Seasonal_naive 2005 Q3
 2 Seasonal_naive 2005 Q4
 3 Seasonal_naive 2006 Q1
 4 Seasonal_naive 2006 Q2
 5 Seasonal_naive 2006 Q3
 6 Seasonal_naive 2006 Q4
 7 Seasonal_naive 2007 Q1
 8 Seasonal_naive 2007 Q2
 9 Seasonal_naive 2007 Q3
10 Seasonal_naive 2007 Q4
11 Seasonal_naive 2008 Q1
12 Seasonal_naive 2008 Q2
13 Seasonal_naive 2008 Q3
14 Seasonal_naive 2008 Q4
15 Seasonal_naive 2009 Q1
16 Seasonal_naive 2009 Q2
17 Seasonal_naive 2009 Q3
18 Seasonal_naive 2009 Q4
19 Seasonal_naive 2010 Q1
20 Seasonal_naive 2010 Q2
# ℹ 5 more variables: Bricks &lt;dist&gt;, .mean &lt;dbl&gt;, `95%` &lt;hilo&gt;, lower &lt;dbl&gt;,
#   upper &lt;dbl&gt;</code></pre>
</div>
</div>
<ul>
<li><p>Point forecasts are often useless without a measure of uncertainty (such as prediction intervals)</p></li>
<li><p>Prediction intervals require a stochastic model (with random errors, etc.)</p></li>
<li><p>For most models, prediction intervals get wider as the forecast horizon increases</p></li>
<li><p>Use <code>level</code> argument to control coverage</p></li>
<li><p>Check residual assumptions before believing them</p></li>
<li><p>Prediction intervals are usually too narrow due to unaccounted uncertainty</p></li>
</ul>
</section>
<section id="forecasting-using-transformations" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-using-transformations">5.6 Forecasting using transformations</h2>
<p>If the data show different variations at different levels of the series, then a transformation can be useful.</p>
<p>Denote original observations as <span class="math inline">\(y_1, ..., y_n\)</span> and transformed observations as <span class="math inline">\(w_1, ..., w_n\)</span>.</p>
<p>Box-Cox transformations:</p>
<p><span class="math display">\[
w_t = \left\{\begin{array}{ll}
        \log(y_t),      &amp; \quad \lambda = 0; \\
        (sign(y_t)|y_t|^\lambda-1)/\lambda ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<ul>
<li>Natural logarithm, particularly useful because they are more interpretable: changes in a log value are relative (percent) changes on the original scale.</li>
</ul>
<p>We must reverse the transformation or back-transform to obtain forecasts on the original scale. The reverse Box-Cox transformations are given by:</p>
<p><span class="math display">\[
w_t = \left\{\begin{array}{ll}
        \exp(w_t),      &amp; \quad \lambda = 0; \\
        (sign(\lambda w_t+1)|\lambda w_t+1|^{1 /\lambda}, &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>eggs <span class="ot">&lt;-</span> prices <span class="sc">|&gt;</span> </span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(eggs)) <span class="sc">|&gt;</span> </span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(eggs)</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>eggs <span class="sc">|&gt;</span> </span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Annual egg prices"</span>,</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$US (adjusted for inflation)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Plot variable not specified, automatically selected `.vars = eggs`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-168-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Transformations used in the left of the formula will be automatically back-transformed. To model log-transformed egg prices, you could use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> eggs <span class="sc">|&gt;</span> </span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">RW</span>(<span class="fu">log</span>(eggs) <span class="sc">~</span> <span class="fu">drift</span>()))</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  `RW(log(eggs) ~ drift())`
                    &lt;model&gt;
1             &lt;RW w/ drift&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>fc <span class="ot">&lt;-</span> fit <span class="sc">|&gt;</span> </span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">50</span>)</span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 50 x 4 [1Y]
# Key:     .model [1]
   .model                   year             eggs .mean
   &lt;chr&gt;                   &lt;dbl&gt;           &lt;dist&gt; &lt;dbl&gt;
 1 RW(log(eggs) ~ drift())  1994 t(N(4.1, 0.018))  61.8
 2 RW(log(eggs) ~ drift())  1995 t(N(4.1, 0.036))  61.4
 3 RW(log(eggs) ~ drift())  1996 t(N(4.1, 0.055))  61.0
 4 RW(log(eggs) ~ drift())  1997 t(N(4.1, 0.074))  60.6
 5 RW(log(eggs) ~ drift())  1998 t(N(4.1, 0.093))  60.2
 6 RW(log(eggs) ~ drift())  1999    t(N(4, 0.11))  59.8
 7 RW(log(eggs) ~ drift())  2000    t(N(4, 0.13))  59.4
 8 RW(log(eggs) ~ drift())  2001    t(N(4, 0.15))  59.0
 9 RW(log(eggs) ~ drift())  2002    t(N(4, 0.18))  58.6
10 RW(log(eggs) ~ drift())  2003     t(N(4, 0.2))  58.3
# ℹ 40 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>fc <span class="sc">|&gt;</span> </span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(eggs) <span class="sc">+</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Annual egg prices"</span>,</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"US$ (adjusted for inflation)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-171-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>Back-transformed point forecasts are medians</p></li>
<li><p>Back-transformed PI have the correct coverage</p></li>
</ul>
<p><strong>Back-transformed means</strong></p>
<p>Let <span class="math inline">\(X\)</span> have mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span></p>
<p>Let <span class="math inline">\(f(x)\)</span> be back-transformed function, and <span class="math inline">\(Y=f(X)\)</span></p>
<p>Taylor series expansion about <span class="math inline">\(\mu\)</span>:</p>
<p><span class="math display">\[
Y=f(X) \approx f(\mu) + (X-\mu)f'(\mu)+\frac{1}{2}(X-\mu)^2f''(\mu)
\]</span></p>
<p><span class="math display">\[
E[Y]=E[f(X)] \approx f(\mu)+\frac{1}{2}\sigma^2f''(\mu)
\]</span></p>
<p><strong>Bias adjustment</strong></p>
<p>Box-Cox back-transformation: <span class="math display">\[
y_t = \left\{\begin{array}{ll}
        \exp(w_t),      &amp; \quad \lambda = 0; \\
        (\lambda w_t+1)^{1/\lambda} ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<p><span class="math display">\[
f(x) = \left\{\begin{array}{ll}
        e^x,      &amp; \quad \lambda = 0; \\
        (\lambda x+1)^{1/\lambda} ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<p><span class="math display">\[
f''(x) = \left\{\begin{array}{ll}
        e^x,      &amp; \quad \lambda = 0; \\
        (1- \lambda)(\lambda x+1)^{1/{\lambda-2}} ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<p><span class="math display">\[
E[Y] \approx \left\{\begin{array}{ll}
        e^\mu[1+\frac{\sigma^2}{2}],      &amp; \quad \lambda = 0; \\
        (\lambda\mu+1)^{1/\lambda}[1+\frac{\sigma^2(1- \lambda)}{2(\lambda\mu+1)^2}] ,         &amp; \quad \lambda \ne 0.
\end{array}\right.
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>fc <span class="sc">|&gt;</span> </span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(eggs, <span class="at">level =</span> <span class="dv">80</span>, <span class="at">point_forecast =</span> <span class="fu">lst</span>(mean, median)) <span class="sc">+</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Annual egg prices"</span>,</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"$US (adjusted for inflation)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-172-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="forecasting-with-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-with-decomposition">5.7 Forecasting with decomposition</h2>
<p><span class="math display">\[
y=\hat{S_t}+\hat{A_t}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\hat{A_t}=\hat{T_t}+\hat{R_t}\)</span> is the seasonally adjusted component</p></li>
<li><p><span class="math inline">\(\hat{S_t}\)</span> is the seasonal component</p></li>
<li><p>Forecast <span class="math inline">\(\hat{S_t}\)</span> using SNAIVE</p></li>
<li><p>Forecast <span class="math inline">\(\hat{A_t}\)</span> using non-seasonal time series method</p></li>
<li><p>Combine forecasts of <span class="math inline">\(\hat{S_t}\)</span> and <span class="math inline">\(\hat{A_t}\)</span> to get forecasts of original data</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="ot">&lt;-</span> us_employment <span class="sc">|&gt;</span> </span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Month) <span class="sc">&gt;=</span> <span class="dv">1990</span>, Title <span class="sc">==</span> <span class="st">"Retail Trade"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Series_ID)</span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>us_retail_employment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 357 x 3 [1M]
        Month Title        Employed
        &lt;mth&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 1990 janv. Retail Trade   13256.
 2 1990 févr. Retail Trade   12966.
 3  1990 mars Retail Trade   12938.
 4  1990 avr. Retail Trade   13012.
 5   1990 mai Retail Trade   13108.
 6  1990 juin Retail Trade   13183.
 7 1990 juil. Retail Trade   13170.
 8  1990 août Retail Trade   13160.
 9 1990 sept. Retail Trade   13113.
10  1990 oct. Retail Trade   13185.
# ℹ 347 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="ot">&lt;-</span> us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">STL</span>(Employed)) <span class="sc">|&gt;</span> </span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.model)</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>dcmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 357 x 6 [1M]
        Month Employed  trend season_year remainder season_adjust
        &lt;mth&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 1990 janv.   13256. 13288.      -33.0      0.836        13289.
 2 1990 févr.   12966. 13269.     -258.     -44.6          13224.
 3  1990 mars   12938. 13250.     -290.     -22.1          13228.
 4  1990 avr.   13012. 13231.     -220.       1.05         13232.
 5   1990 mai   13108. 13211.     -114.      11.3          13223.
 6  1990 juin   13183. 13192.      -24.3     15.5          13207.
 7 1990 juil.   13170. 13172.      -23.2     21.6          13193.
 8  1990 août   13160. 13151.       -9.52    17.8          13169.
 9 1990 sept.   13113. 13131.      -39.5     22.0          13153.
10  1990 oct.   13185. 13110.       61.6     13.2          13124.
# ℹ 347 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>dcmp <span class="sc">|&gt;</span> </span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">NAIVE</span>(season_adjust)) <span class="sc">|&gt;</span> </span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>() <span class="sc">|&gt;</span> </span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(dcmp) <span class="sc">+</span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Naive forecasts of seasonally adjusted data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-175-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>us_retail_employment <span class="sc">|&gt;</span> </span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stlf =</span> <span class="fu">decomposition_model</span>(</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">STL</span>(Employed <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">7</span>), <span class="at">robust =</span> <span class="cn">TRUE</span>),</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">NAIVE</span>(season_adjust)</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>() <span class="sc">|&gt;</span> </span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(us_retail_employment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-176-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><code>decomposition_model()</code> creates a decomposition model</p>
<ul>
<li><p>You must provide a method for forecasting the <code>season_adjust</code> series</p></li>
<li><p>A seasonal naive method is used by default for the <code>seasonal</code> components</p></li>
<li><p>The variances from both the seasonally adjusted and seasonal forecasts are combined</p></li>
</ul>
</section>
<section id="evaluating-point-forecast-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-point-forecast-accuracy">5.8 Evaluating point forecast accuracy</h2>
<p><strong>Training and test sets</strong></p>
<ul>
<li><p>A model which fits the training data well will not necessarily forecast well</p></li>
<li><p>A perfect fit can always be obtained by using a model with enough parameters</p></li>
<li><p>Over-fitting a model to data is just as bad as failing to identify a systematic pattern in the data</p></li>
<li><p>The test set must not be used for <em>any</em> aspect of model development or calculation of forecasts</p></li>
<li><p>Forecast accuracy is based only on the test set</p></li>
</ul>
<p>Forecast “error”: the difference between an observed value and its forecast.</p>
<p><span class="math display">\[
e_{T+h}=y_{T+h}-\hat{y_{T+h|T}}
\]</span></p>
<p>where the training data is given by <span class="math inline">\(\{y_1,...,y_T\}\)</span>.</p>
<ul>
<li><p>Unlike residuals, forecast errors on the test set involve multi-step forecasts.</p></li>
<li><p>There are <em>true</em> forecast errors as the test data is not used in computing <span class="math inline">\(\hat{y}_{T+h|T}\)</span>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>recent_production <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>beer_train <span class="ot">&lt;-</span> recent_production <span class="sc">|&gt;</span></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&lt;=</span> <span class="dv">2007</span>)</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>beer_fit <span class="ot">&lt;-</span> beer_train <span class="sc">|&gt;</span></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">MEAN</span>(Beer),</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">NAIVE</span>(Beer),</span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Seasonal naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">SNAIVE</span>(Beer),</span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Drift =</span> <span class="fu">RW</span>(Beer <span class="sc">~</span> <span class="fu">drift</span>())</span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="ot">&lt;-</span> beer_fit <span class="sc">|&gt;</span></span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">10</span>)</span>
<span id="cb275-16"><a href="#cb275-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-17"><a href="#cb275-17" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="sc">|&gt;</span></span>
<span id="cb275-18"><a href="#cb275-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(</span>
<span id="cb275-19"><a href="#cb275-19" aria-hidden="true" tabindex="-1"></a>    aus_production <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>),</span>
<span id="cb275-20"><a href="#cb275-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">level =</span> <span class="cn">NULL</span></span>
<span id="cb275-21"><a href="#cb275-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-22"><a href="#cb275-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb275-23"><a href="#cb275-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Megalitres"</span>,</span>
<span id="cb275-24"><a href="#cb275-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Forecasts for quarterly beer production"</span></span>
<span id="cb275-25"><a href="#cb275-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb275-26"><a href="#cb275-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-177-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Measures of forecast accuracy</strong></p>
<p><span class="math inline">\(y_{T+h}\)</span>: (T+h)th observation, h =1, … H</p>
<p><span class="math inline">\(\hat{y}_{T+h}\)</span>: its forecast based on data up to time T</p>
<p><span class="math inline">\(e_{T+h}=y_{T+h}-\hat{y}_{T+h|T}\)</span></p>
<p>ME = mean(<span class="math inline">\(e_{T+h})\)</span></p>
<p>MAE = mean(<span class="math inline">\(|e_{T+h}|)\)</span></p>
<p>MSE = mean(<span class="math inline">\(e^2_{T+h})\)</span></p>
<p>RMSE = sqrt(mean(<span class="math inline">\(e^2_{T+h})\)</span>)</p>
<p>MAPE = 100mean(<span class="math inline">\(|e_{T+h}|/|y_{T+h}|)\)</span></p>
<ul>
<li><p>MAE, MSE, RMSE are all scale dependent</p></li>
<li><p>MAPE is scale independent but is only sensible if <span class="math inline">\(y_t &gt;&gt; 0\)</span> for all t, and y has a natural zero.</p></li>
</ul>
<p>Proposed by Hyndman and Koehler (IJF, 2006):</p>
<ul>
<li>For non-seasonal time series, scale errors using naïve forecasts</li>
</ul>
<p><span class="math display">\[
q_j=\frac{e_j}{\frac{1}{T-1}\sum_{t=2}^T|y_t-y_{t-1}|}
\]</span></p>
<ul>
<li>For seasonal time series, scale forecast errors using seasonal naïve forecasts</li>
</ul>
<p><span class="math display">\[
q_j=\frac{e_j}{\frac{1}{T-m}\sum_{t=m+1}^T|y_t-y_{t-m}|}
\]</span></p>
<p>Mean Absolute Scaled Error: MASE = <span class="math inline">\(mean(|q_j|)\)</span></p>
<p>Root Mean Squared Scaled Error: RMSSE = <span class="math inline">\(\sqrt{mean(q_j^2)}\)</span></p>
<p>where</p>
<p><span class="math display">\[
q_j^2=\frac{e^2_j}{\frac{1}{T-m}\sum_{t=2}^T(y_t-y_{t-m})^2}
\]</span></p>
<p>and we set m=1 for non-seasonal data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>recent_production <span class="ot">&lt;-</span> aus_production <span class="sc">|&gt;</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>)</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>beer_train <span class="ot">&lt;-</span> recent_production <span class="sc">|&gt;</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&lt;=</span> <span class="dv">2007</span>)</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>beer_fit <span class="ot">&lt;-</span> beer_train <span class="sc">|&gt;</span></span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(</span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">MEAN</span>(Beer),</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">NAIVE</span>(Beer),</span>
<span id="cb276-10"><a href="#cb276-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Seasonal naïve</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">SNAIVE</span>(Beer),</span>
<span id="cb276-11"><a href="#cb276-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Drift =</span> <span class="fu">RW</span>(Beer <span class="sc">~</span> <span class="fu">drift</span>())</span>
<span id="cb276-12"><a href="#cb276-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb276-13"><a href="#cb276-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-14"><a href="#cb276-14" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="ot">&lt;-</span> beer_fit <span class="sc">|&gt;</span></span>
<span id="cb276-15"><a href="#cb276-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">10</span>)</span>
<span id="cb276-16"><a href="#cb276-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-17"><a href="#cb276-17" aria-hidden="true" tabindex="-1"></a>beer_fc <span class="sc">|&gt;</span></span>
<span id="cb276-18"><a href="#cb276-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(</span>
<span id="cb276-19"><a href="#cb276-19" aria-hidden="true" tabindex="-1"></a>    aus_production <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">year</span>(Quarter) <span class="sc">&gt;=</span> <span class="dv">1992</span>),</span>
<span id="cb276-20"><a href="#cb276-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">level =</span> <span class="cn">NULL</span></span>
<span id="cb276-21"><a href="#cb276-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb276-22"><a href="#cb276-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb276-23"><a href="#cb276-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Megalitres"</span>,</span>
<span id="cb276-24"><a href="#cb276-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Forecasts for quarterly beer production"</span></span>
<span id="cb276-25"><a href="#cb276-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb276-26"><a href="#cb276-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fpp3_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Measures of forecast accuracy</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(beer_fit) <span class="sc">|&gt;</span> </span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.model) <span class="sc">|&gt;</span> </span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, .type, RMSE, MAE, MAPE, MASE, RMSSE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  .model         .type     RMSE   MAE  MAPE  MASE RMSSE
  &lt;chr&gt;          &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Drift          Training  65.3  54.8 12.2   3.83  3.89
2 Mean           Training  43.6  35.2  7.89  2.46  2.60
3 Naïve          Training  65.3  54.7 12.2   3.83  3.89
4 Seasonal naïve Training  16.8  14.3  3.31  1     1   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(beer_fc, recent_production) <span class="sc">|&gt;</span> </span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.model) <span class="sc">|&gt;</span> </span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.model, .type, RMSE, MAE, MAPE, MASE, RMSSE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  .model         .type  RMSE   MAE  MAPE  MASE RMSSE
  &lt;chr&gt;          &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Drift          Test   64.9  58.9 14.6  4.12  3.87 
2 Mean           Test   38.4  34.8  8.28 2.44  2.29 
3 Naïve          Test   62.7  57.4 14.2  4.01  3.74 
4 Seasonal naïve Test   14.3  13.4  3.17 0.937 0.853</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>